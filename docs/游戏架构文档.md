# 《灵境斗宠录》完整游戏架构文档

## 🎮 游戏概述
基于世界树种子概念的AI驱动文字宠物养成游戏，融合山海经神话元素，通过三层AI模型实现独特的宠物生成和进化系统。

## 🏗️ 系统架构

### 1. 技术栈
```
前端: HTML5 + CSS3 + JavaScript (原生)
后端: Node.js + Express.js
数据库: SQLite3
AI服务: DeepSeek API
部署: 本地开发 → Vercel → Steam
```

### 2. 目录结构
```
chognwu/
├── src/                    # 核心源码
│   ├── ai/                # AI系统模块
│   │   ├── AIService.js           # AI服务基础类
│   │   ├── PetLoreGenerator.js    # 宠物背景生成器
│   │   ├── PetMatchingEngine.js   # 宠物匹配引擎
│   │   └── ThreeLayerEngine.js    # 三层AI引擎
│   ├── data/              # 数据模块
│   │   └── petDatabase.js         # 宠物数据库
│   ├── game/              # 游戏逻辑
│   │   ├── EvolutionSystem.js     # 进化系统
│   │   └── GameEngine.js          # 游戏引擎
│   ├── models/            # 数据模型
│   │   └── database.js            # 数据库管理
│   ├── routes/            # API路由
│   │   ├── petGeneratorRoutes.js  # 宠物生成路由
│   │   └── storyRoutes.js         # 剧情路由
│   ├── story/             # 剧情系统
│   │   ├── StoryEngine.js         # 剧情引擎
│   │   ├── StoryDatabase.js       # 剧情数据库
│   │   └── StoryIntegration.js    # 剧情集成
│   ├── utils/             # 工具类
│   │   └── logger.js              # 日志系统
│   └── app.js             # 主应用入口
├── public/                # 前端资源
│   ├── line-by-line-adventure.html # 主游戏界面
│   ├── local-game.html            # 本地游玩界面
│   └── *.js               # 前端脚本
├── data/                  # 数据存储
│   └── game.db           # SQLite数据库文件
├── docs/                  # 文档
├── logs/                  # 日志文件
└── start.js              # 启动脚本
```

## 🎯 核心系统

### 1. 三层AI模型架构
```
L1 记录层 (Record Layer)
├── 收集玩家行为数据
├── 记录宠物互动历史
└── 存储环境变化信息

L2 进化层 (Evolution Layer)  
├── 分析行为模式
├── 计算进化概率
└── 生成新特性词条

L3 判断层 (Judgment Layer)
├── 评估进化合理性
├── 固化最终结果
└── 更新宠物属性
```

### 2. 宠物生成系统
```
AI大模型生成完整设定 → 数据库存储核心数据
├── 完整背景故事 (AI生成 + 提示词设定)
├── 详细描述文本 (存储在数据库)
├── 核心属性数据 (种族、特质、属性、特殊词条)
└── 独特性保证 (每个宠物都是唯一的)
```

### 3. 数据库结构

#### 当前表结构:
- **users**: 用户信息
- **pets**: 宠物基础信息 (需要扩展)
- **pet_traits**: 宠物词条
- **pet_behaviors**: 行为记录
- **adventure_events**: 冒险事件
- **pet_encounters**: 宠物相遇
- **battle_records**: 战斗记录
- **game_config**: 游戏配置

#### 需要新增的表:
- **pet_lore**: 宠物背景故事和详细描述
- **pet_species**: 宠物种族模板
- **story_templates**: 剧情模板库

## 🎨 游戏界面

### 1. 本地游玩模式
- 无需注册登录
- 直接开始游戏体验
- 数据存储在本地浏览器

### 2. 在线模式 (上线后)
- 用户注册登录
- 云端数据同步
- 多设备访问

## 🚀 运行方式

### 本地开发
```bash
# 1. 安装依赖
npm install

# 2. 启动服务器
node start.js

# 3. 访问游戏
http://localhost:3000
```

### 部署流程
```
本地开发 → GitHub → Vercel → 自定义域名 → Steam发布
```

## 🎲 游戏机制

### 1. 宠物获取
- 开局三选一神秘描述
- AI智能匹配宠物
- SSR概率1%，其他稀有度递增

### 2. 宠物命名规则
```
格式: 种族*属性*特殊词
示例: 火龙*暗*绝迹
```

### 3. 稀有度系统
- SSS: 七彩色 (传说级)
- SSR: 红色 (超稀有) - 1%概率
- SR: 紫色 (稀有)
- R: 蓝色 (普通)
- N: 灰色 (常见)

### 4. 世界观设定
```
世界树种子 → 衍生世界
├── 森林 (自然系宠物)
├── 高原 (土系宠物) 
├── 海洋 (水系宠物)
├── 天空 (风系宠物)
├── 梦幻空间 (幻系宠物)
├── 灵界 (灵系宠物)
└── 龙界 (龙系宠物)
```

## 📊 数据流程

### 1. 宠物生成流程
```
玩家选择 → AI分析 → 匹配算法 → 生成核心数据 → 
AI创作背景 → 存储完整信息 → 返回给玩家
```

### 2. 进化流程
```
行为记录 → L1收集 → L2分析 → L3判断 → 
属性更新 → 新词条生成 → 背景故事更新
```

## 🔧 配置说明

### 环境变量
```
DB_PATH=./data/game.db          # 数据库路径
AI_API_KEY=your_deepseek_key    # AI API密钥
PORT=3000                       # 服务端口
NODE_ENV=development            # 运行环境
```

### AI提示词配置
- 宠物生成提示词
- 背景故事生成提示词  
- 进化判断提示词
- 剧情生成提示词

## 📈 扩展计划

### 短期目标
1. 完善本地游玩界面
2. 优化AI生成质量
3. 增加更多宠物种类
4. 完善剧情系统

### 长期目标
1. 多人对战系统
2. 公会系统
3. 交易市场
4. Steam版本发布

## 🎯 作者信息
- 作者: 树枝
- 微信: wzq8083
- 项目: 《灵境斗宠录》AI宠物养成游戏