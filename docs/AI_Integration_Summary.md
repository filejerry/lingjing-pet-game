# AI接入能力梳理

## 概述
《山海经灵境斗宠录》集成了三种不同类型的AI模型，分别用于文字生成、批量推理和图像生成。

## 1. 文字模型 - Kimi (实时对话)

### 配置信息
- **API Key**: `2ffe7955-a0a1-4238-93cd-d354c2c6d7ec`
- **接入方式**: 
  ```bash
  curl https://ark.cn-beijing.volces.com/api/v3/chat/completions \
    -H "Content-Type: application/json" \
    -H "Authorization: Bearer 2ffe7955-a0a1-4238-93cd-d354c2c6d7ec" \
    -d '{
      "model": "kimi-k2-250905",
      "messages": [
        {"role": "system","content": "你是人工智能助手."},
        {"role": "user","content": "你好"}
      ]  
    }'
  ```
- **模型**: `kimi-k2-250905`

### 使用场景
- ✅ 实时玩家对话
- ✅ 即时剧情生成
- ✅ 宠物互动对话
- ✅ 快速事件响应

### 特点
- 响应速度快 (< 3秒)
- 适合实时交互
- 支持中文对话
- 上下文理解能力强

## 2. 批量推理模型 - Kimi (批量内容生成)

### 配置信息
- **API Key**: `2ffe7955-a0a1-4238-93cd-d354c2c6d7ec` (与实时模型共用)
- **接入方式**: 同上，但采用批量并发调用
- **模型**: `kimi-k2-250905`

### 使用场景
- ✅ 预生成故事内容池
- ✅ 批量生成宠物性格模板
- ✅ 大量剧情分支生成
- ✅ 背景故事批量创作

### 特点
- 支持并发处理 (最多10个并发)
- 适合离线内容生成
- 成本效率高
- 内容质量稳定

## 3. 图像模型 - 即梦4.0 (美术资源生成)

### 配置信息
- **用途**: 专门用于美术资源生成
- **应用场景**:
  - 🎨 宠物外形设计
  - 🖼️ 关键场景图片
  - 🌟 特殊事件插图
  - 🏞️ 背景环境图

### 集成方式
```javascript
// 关键场景图片生成
const sceneImage = await this.imageService.generateSceneImage({
  scene: "九尾狐在昆仑山顶的神秘相遇",
  style: "山海经神话风格",
  mood: "神秘而庄严"
});

// 宠物外形生成
const petImage = await this.imageService.generatePetImage({
  creature: "青鸾",
  attributes: ["优雅", "神圣", "蓝色羽毛"],
  pose: "展翅飞翔"
});
```

### 特点
- 专注于视觉内容
- 山海经神话风格
- 高质量美术资源
- 与剧情内容联动

## 4. 智能路由系统

### 功能
- 🔄 自动选择最适合的AI模型
- ⚡ 实时请求路由到Kimi
- 📦 批量请求路由到批量推理
- 🎨 图像请求路由到即梦4.0

### 路由规则
```javascript
// 实时对话 -> Kimi实时
if (requestType === 'realtime') {
  return await this.kimiService.generateContent(prompt);
}

// 批量生成 -> Kimi批量
if (requestType === 'batch') {
  return await this.batchService.batchGenerate(prompts);
}

// 图像生成 -> 即梦4.0
if (requestType === 'image') {
  return await this.imageService.generateImage(prompt);
}
```

## 5. 集成架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   玩家请求      │    │   智能路由器    │    │   AI模型选择    │
│                 │───▶│                 │───▶│                 │
│ - 对话          │    │ - 请求分析      │    │ - Kimi实时      │
│ - 剧情生成      │    │ - 模型选择      │    │ - Kimi批量      │
│ - 图像需求      │    │ - 负载均衡      │    │ - 即梦4.0       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 6. 性能优化

### 内容池策略
- 📚 预生成故事内容池 (100+故事)
- 🎭 预生成性格模板池 (50+性格)
- 🔄 定期刷新内容池
- ⚡ 快速响应用户请求

### 缓存机制
- 🗄️ 常用剧情缓存
- 🎨 生成图片缓存
- 💾 用户对话历史缓存

## 7. 使用统计

### 模型使用分配
- **Kimi实时**: 60% (用户交互)
- **Kimi批量**: 30% (内容生成)
- **即梦4.0**: 10% (图像生成)

### 响应时间目标
- 实时对话: < 3秒
- 批量生成: < 30秒
- 图像生成: < 10秒

## 8. 成本控制

### 优化策略
- 🎯 智能缓存减少重复请求
- 📊 批量处理降低单次成本
- 🔄 内容池复用提高效率
- ⚖️ 负载均衡优化资源使用

### 监控指标
- API调用次数
- 响应时间
- 错误率
- 成本统计

---

*最后更新: 2025年9月30日*
*状态: ✅ Kimi模型已配置 | ⚠️ 即梦4.0待配置*