<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å±±æµ·ç»çµå¢ƒæ–—å® å½•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .scene-aura {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, rgba(255, 215, 0, 0.1) 0%, transparent 70%);
            pointer-events: none;
            z-index: 1;
        }

        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-btn {
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: rgba(255, 215, 0, 0.5);
        }

        .immersive-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            z-index: 10;
            position: relative;
        }

        .story-stage {
            max-width: 800px;
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .story-content {
            min-height: 300px;
            margin-bottom: 30px;
            line-height: 1.8;
            font-size: 1.1em;
        }

        .story-line {
            margin-bottom: 20px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 1s ease;
        }

        .story-line.show {
            opacity: 1;
            transform: translateY(0);
        }

        .story-line.title {
            font-size: 1.4em;
            color: #ffd700;
            text-align: center;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .story-line.normal {
            color: #e0e0e0;
            text-align: center;
        }

        .choices-container {
            display: none;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease;
        }

        .choices-container.show {
            opacity: 1;
            transform: translateY(0);
        }

        .choice-button {
            display: block;
            width: 100%;
            padding: 20px 25px;
            margin: 15px 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
            border: 2px solid rgba(255, 215, 0, 0.4);
            border-radius: 15px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 1.1em;
            text-align: left;
            transition: all 0.3s ease;
            backdrop-filter: blur(15px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
            position: relative;
            overflow: hidden;
        }

        .choice-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.2), transparent);
            transition: left 0.5s;
        }

        .choice-button:hover::before {
            left: 100%;
        }

        .choice-button:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.5) 0%, rgba(118, 75, 162, 0.5) 100%);
            border-color: rgba(255, 215, 0, 0.8);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .loading {
            text-align: center;
            color: #ffd700;
            font-size: 1.2em;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* ç‰¹æ®Šæ ‡è®°æ ·å¼ */
        .special-marker {
            color: #ffd700;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.6);
        }

        .creature-marker {
            color: #4a9eff;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(74, 158, 255, 0.6);
        }

        .world-tree-marker {
            color: #32cd32;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(50, 205, 50, 0.6);
        }

        .ai-marker {
            color: #ff6b6b;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(255, 107, 107, 0.6);
        }

        /* äº’åŠ¨é¢æ¿æ ·å¼ */
        .interaction-panel {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border: 2px solid #4a5568;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .interaction-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .interaction-header h3 {
            color: #ffd700;
            font-size: 24px;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .interaction-header p {
            color: #a0aec0;
            font-size: 16px;
            line-height: 1.5;
        }

        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .choice-btn {
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 15px;
            color: white;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
            text-align: left;
        }

        .choice-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
            background: linear-gradient(135deg, #7c8df0 0%, #8a5cb8 100%);
        }

        .choice-icon {
            font-size: 32px;
            margin-right: 20px;
            min-width: 50px;
            text-align: center;
        }

        .choice-text strong {
            display: block;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .choice-text small {
            display: block;
            font-size: 14px;
            opacity: 0.8;
            line-height: 1.3;
        }
    </style>
</head>
<body>
    <div class="scene-aura"></div>
    
    <!-- å³ä¸Šè§’æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
        <button class="control-btn" id="btnStoryStart">å¼€å§‹æ•…äº‹</button>
        <button class="control-btn" id="btnRestart">é‡æ–°å¼€å§‹</button>
        <button class="control-btn" id="btnPanel">é¢æ¿</button>
    </div>

    <div class="immersive-container">
        <div class="story-stage">
            <div class="story-content" id="storyContent">
                <div class="loading">æ­£åœ¨å”¤é†’ä¸–ç•Œæ ‘çš„è®°å¿†</div>
            </div>
            <div class="choices-container" id="choicesContainer">
                <!-- é€‰æ‹©æŒ‰é’®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            currentPet: null,
            petCount: 0,
            bestRarity: '-',
            evolutionCount: 0
        };

        // åº”ç”¨ç‰¹æ®Šæ ‡è®°
        function applySpecialMarkers(text) {
            return text
                .replace(/â€»([^â€»]+)â€»/g, '<span class="special-marker">â€»$1â€»</span>')
                .replace(/â—‰([^â—‰]+)â—‰/g, '<span class="creature-marker">â—‰$1â—‰</span>')
                .replace(/â€»\s*ä¸–ç•Œæ ‘\s*â€»/g, '<span class="world-tree-marker">â€» ä¸–ç•Œæ ‘ â€»</span>')
                .replace(/â—‰\s*AI[^â—‰]*â—‰/g, '<span class="ai-marker">$&</span>');
        }

        // æ˜¾ç¤ºæ•…äº‹è¡Œ
        function showStoryLinesWithClasses(lines, container, callback) {
            container.innerHTML = '';
            
            lines.forEach((line, index) => {
                setTimeout(() => {
                    const lineElement = document.createElement('div');
                    lineElement.className = `story-line ${line.class}`;
                    lineElement.innerHTML = applySpecialMarkers(line.text);
                    container.appendChild(lineElement);
                    
                    setTimeout(() => {
                        lineElement.classList.add('show');
                    }, 200);
                    
                    if (index === lines.length - 1 && callback) {
                        setTimeout(callback, 1500);
                    }
                }, index * 1500);
            });
        }

        // æ˜¾ç¤ºé€‰æ‹©
        function showChoices() {
            const pool = [
                { text: "æˆ‘å¬åˆ°äº†å¤è€çš„é¾™åŸå£°ï¼Œä»¿ä½›æ¥è‡ªæ—¶é—´çš„æ·±å¤„ï¼Œå……æ»¡äº†å¨ä¸¥ä¸ç¥ç§˜...", type: "dragon", rarity: 0.15 },
                { text: "æˆ‘æ„Ÿå—åˆ°äº†è‡ªç„¶çš„å‘¼å”¤ï¼ŒèŠ±è‰æ ‘æœ¨éƒ½åœ¨å‘æˆ‘è¯‰è¯´ç€ç”Ÿå‘½çš„å¥¥ç§˜...", type: "nature", rarity: 0.1 },
                { text: "æˆ‘çœ‹è§äº†æ˜Ÿç©ºä¸­çš„å¹»è±¡ï¼Œæ— æ•°çš„å¯èƒ½æ€§åœ¨è™šç©ºä¸­é—ªçƒç€å…‰èŠ’...", type: "mystic", rarity: 0.12 },
                { text: "å¤œå¹•ä½å‚ï¼Œå½±å­åœ¨æ—é—´ç©¿æ¢­ï¼Œä½ ä»¿ä½›å¬è§æ®‹å½±å‘¼å”¤â€¦", type: "shadow", rarity: 0.08 },
                { text: "æ—¶é—´åƒæ°´æµå€’è½¬ï¼Œå¤è€çš„é’Ÿé¸£åœ¨å¿ƒåº•å›å“â€¦", type: "chrono", rarity: 0.2 },
                { text: "ç¾¤æ˜Ÿç¼“ç¼“æ—‹è½¬ï¼Œå¤©è±¡ä¼¼åœ¨æš—ç¤ºå‘½è¿çš„åˆ†å²”â€¦", type: "stellar", rarity: 0.18 },
                { text: "æ½®æ±æ‹å²¸ï¼Œä½ åœ¨é›¾æµ·ä¸­çœ‹è§å·¨é²²çš„è½®å»“â€¦", type: "ocean", rarity: 0.14 },
                { text: "è¿œæ–¹å±±è„‰éœ‡åŠ¨ï¼Œå²©åœŸä¹‹åŠ›å›åº”ä½ çš„è„šæ­¥â€¦", type: "earth", rarity: 0.06 },
                { text: "ç‚½ç„°å‡è…¾ï¼Œç«ç¾½åœ¨ç©ºä¸­åˆ’å‡ºç¼äº®çš„è½¨è¿¹â€¦", type: "flame", rarity: 0.11 },
                { text: "å¯’éœœé™ä¸´ï¼Œæ™¶èŠ±åœ¨æŒ‡å°–ç»½æ”¾â€¦", type: "frost", rarity: 0.09 },
                { text: "é›·éœ†è´¯ç©ºï¼Œç”µçº¹åœ¨åœ°é¢èœ¿èœ’â€¦", type: "thunder", rarity: 0.13 },
                { text: "çµæ³‰æ¶ŒåŠ¨ï¼Œä½ æ„Ÿåˆ°çµè¯†è¢«è½»è§¦â€¦", type: "spirit", rarity: 0.07 }
            ];

            // éšæœºäº‹ä»¶æ± 
            const specialEvents = [
                { text: "â€» ä¸–ç•Œæ ‘çš„æå¶çªç„¶å‘å…‰ï¼Œä½ æ„Ÿå—åˆ°äº†åˆ›ä¸–çš„åŠ›é‡åœ¨å¬å”¤...", type: "genesis", rarity: 0.5 },
                { text: "â€» è™šç©ºè£‚ç¼å‡ºç°ï¼Œå¼‚ç•Œçš„æ°”æ¯ä»ä¸­æ¶Œå‡º...", type: "void", rarity: 0.4 },
                { text: "â€» è¿œå¤å°å°æ¾åŠ¨ï¼Œè¢«ç¦é”¢çš„ç¥å…½å‘å‡ºä½åŸ...", type: "ancient", rarity: 0.45 },
                { text: "â€» å‘½è¿ä¹‹è½®è½¬åŠ¨ï¼Œä½ å¬è§äº†å®¿å‘½çš„å‘¼å”¤...", type: "destiny", rarity: 0.35 },
                { text: "â€» æ··æ²Œä¹‹åŠ›æ¶ŒåŠ¨ï¼ŒåŸå§‹çš„åˆ›é€ åŠ›åœ¨ä½ å‘¨å›´èšé›†...", type: "chaos", rarity: 0.3 }
            ];

            let finalPool = [...pool];
            
            // 15%æ¦‚ç‡æ·»åŠ ç‰¹æ®Šäº‹ä»¶
            if (Math.random() < 0.15) {
                const randomEvent = specialEvents[Math.floor(Math.random() * specialEvents.length)];
                finalPool.push(randomEvent);
            }

            // é€‰æ‹©3-4ä¸ªé€‰é¡¹
            const count = Math.floor(3 + Math.random() * 2);
            const choices = [];
            const usedIndices = new Set();
            
            while (choices.length < count && choices.length < finalPool.length) {
                const randomIndex = Math.floor(Math.random() * finalPool.length);
                if (!usedIndices.has(randomIndex)) {
                    choices.push(finalPool[randomIndex]);
                    usedIndices.add(randomIndex);
                }
            }

            const choicesContainer = document.getElementById('choicesContainer');
            choicesContainer.innerHTML = '';
            
            choices.forEach((choice, index) => {
                setTimeout(() => {
                    const button = document.createElement('button');
                    button.className = 'choice-button';
                    button.innerHTML = applySpecialMarkers(choice.text);
                    button.addEventListener('click', () => selectChoice(choice));
                    button.style.opacity = '0';
                    button.style.transform = 'translateY(20px)';
                    choicesContainer.appendChild(button);
                    
                    setTimeout(() => {
                        button.style.transition = 'all 0.8s ease';
                        button.style.opacity = '1';
                        button.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 500);
            });

            choicesContainer.style.display = 'block';
            setTimeout(() => {
                choicesContainer.classList.add('show');
            }, 500);
        }

        // é€‰æ‹©å¤„ç†
        async function selectChoice(choice) {
            const choicesContainer = document.getElementById('choicesContainer');
            choicesContainer.style.transition = 'all 0.8s ease';
            choicesContainer.style.opacity = '0';
            choicesContainer.style.transform = 'translateY(-20px)';
            
            setTimeout(() => {
                choicesContainer.style.display = 'none';
                
                const loadingLines = [
                    { text: "ä½ çš„é€‰æ‹©å¼•èµ·äº†ä¸–ç•Œæ ‘çš„å…±é¸£...", class: "normal" },
                    { text: "â—‰ æ­£åœ¨åˆ†æä½ çš„çµé­‚é¢‘ç‡ â—‰", class: "normal" },
                    { text: "â€» ä¸–ç•Œæ ‘ â€» æ­£åœ¨ä¸ºä½ å¯»æ‰¾æœ€åˆé€‚çš„ä¼™ä¼´...", class: "normal" },
                    { text: "è¯·ç¨ç­‰ï¼Œå¥‡è¿¹å³å°†é™ä¸´...", class: "normal" }
                ];

                const storyContent = document.getElementById('storyContent');
                showStoryLinesWithClasses(loadingLines, storyContent, () => {
                    generatePet(choice.type);
                });
            }, 800);
        }

        // ç”Ÿæˆå® ç‰©
        async function generatePet(choiceType) {
            try {
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const pet = await mockPetGeneration(choiceType);
                
                gameState.currentPet = pet;
                gameState.petCount++;
                
                showPetStory(pet);
                
            } catch (error) {
                console.error('ç”Ÿæˆå® ç‰©å¤±è´¥:', error);
                showError('ç”Ÿæˆå® ç‰©æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·é‡è¯•');
            }
        }

        // æ¨¡æ‹Ÿå® ç‰©ç”Ÿæˆ
        async function mockPetGeneration(choiceType) {
            // å¢å¼ºçš„ç¨€æœ‰åº¦ç³»ç»Ÿ
            let rarityModifier = 0;
            const specialTypes = ['genesis', 'void', 'ancient', 'destiny', 'chaos'];
            
            if (specialTypes.includes(choiceType)) {
                rarityModifier = 0.1;
            }
            
            const hour = new Date().getHours();
            if (hour >= 23 || hour <= 1) rarityModifier += 0.05;
            if (hour >= 6 && hour <= 8) rarityModifier += 0.03;
            if (Math.random() < 0.1) rarityModifier += 0.08;
            
            const rarityRoll = Math.random() - rarityModifier;
            let rarity, rarityClass;
            
            if (rarityRoll < 0.005) {
                rarity = 'LEGEND';
                rarityClass = 'rarity-legend';
            } else if (rarityRoll < 0.02) {
                rarity = 'SSS';
                rarityClass = 'rarity-sss';
            } else if (rarityRoll < 0.08) {
                rarity = 'SSR';
                rarityClass = 'rarity-ssr';
            } else if (rarityRoll < 0.20) {
                rarity = 'SR';
                rarityClass = 'rarity-sr';
            } else if (rarityRoll < 0.45) {
                rarity = 'R';
                rarityClass = 'rarity-r';
            } else {
                rarity = 'N';
                rarityClass = 'rarity-n';
            }

            const petTemplates = {
                dragon: {
                    species: ['ç«é¾™', 'å†°é¾™', 'é›·é¾™', 'æš—é¾™', 'å…‰é¾™', 'é’é¾™', 'é‡‘é¾™', 'é“¶é¾™', 'é»‘é¾™', 'ç™½é¾™'],
                    attributes: ['çƒˆç„°', 'å¯’å†°', 'é›·é¸£', 'æš—å½±', 'åœ£å…‰', 'æ¯ç­', 'åˆ›é€ ', 'æ··æ²Œ', 'ç§©åº', 'è™šæ— '],
                    specials: ['ç»è¿¹', 'ä¼ è¯´', 'å¤è€', 'ç¥ç§˜', 'æ°¸æ’', 'ä¸æœ½', 'è‡³å°Š', 'éœ¸ä¸»', 'å¸ç‹', 'ç¥åœ£'],
                    emoji: 'ğŸ‰'
                },
                nature: {
                    species: ['æœ¨ç²¾', 'èŠ±ä»™', 'æ ‘çµ', 'è‰å¦–', 'è—¤æ€ª', 'æ£®ç‹', 'èŠ±ç¥', 'æ ‘ç¥–', 'å¶å¦–', 'æ ¹é­”'],
                    attributes: ['ç”Ÿæœº', 'æ²»æ„ˆ', 'æˆé•¿', 'ç¹èŒ‚', 'æ–°ç”Ÿ', 'å‡‹é›¶', 'è½®å›', 'å­£èŠ‚', 'ä¸°æ”¶', 'æ¯è£'],
                    specials: ['ç›ç„¶', 'ç¿ ç»¿', 'èŠ¬èŠ³', 'èŒ‚ç››', 'ç”Ÿæœº', 'åŸå§‹', 'é‡æ€§', 'çº¯å‡€', 'å’Œè°', 'æ°¸ç”Ÿ'],
                    emoji: 'ğŸŒ¿'
                },
                mystic: {
                    species: ['å¹»çµ', 'æ˜Ÿå…½', 'è™šå½±', 'æ¢¦é­‡', 'æ—¶çµ', 'ç©ºçµ', 'é­‚ä½“', 'æ„å¿µ', 'é¢„è¨€', 'å åœ'],
                    attributes: ['å¹»è±¡', 'æ˜Ÿå…‰', 'è™šæ— ', 'æ¢¦å¢ƒ', 'æ—¶é—´', 'ç©ºé—´', 'çµé­‚', 'æ„è¯†', 'é¢„çŸ¥', 'å®¿å‘½'],
                    specials: ['ç¥ç§˜', 'ç¼¥ç¼ˆ', 'è™šå¹»', 'æ°¸æ’', 'æ— é™', 'è¶…è„±', 'è§‰é†’', 'å¯ç¤º', 'çœŸç†', 'æ™ºæ…§'],
                    emoji: 'âœ¨'
                },
                genesis: {
                    species: ['åˆ›ä¸–', 'åŸåˆ', 'æ··æ²Œ', 'å¤ªåˆ', 'å¼€å¤©', 'è¾Ÿåœ°', 'é€ ç‰©', 'ç”Ÿå‘½', 'æ„å¿—', 'æœ¬æº'],
                    attributes: ['åˆ›é€ ', 'æ¯ç­', 'é‡ç”Ÿ', 'æ¼”åŒ–', 'èµ·æº', 'ç»ˆç»“', 'å¾ªç¯', 'å¹³è¡¡', 'å’Œè°', 'ç»Ÿä¸€'],
                    specials: ['è‡³é«˜', 'æ— ä¸Š', 'å”¯ä¸€', 'ç»å¯¹', 'å®Œç¾', 'æ°¸æ’', 'æ— é™', 'å…¨çŸ¥', 'å…¨èƒ½', 'è¶…è¶Š'],
                    emoji: 'ğŸŒŸ'
                }
            };

            const typeMap = {
                shadow: 'mystic', chrono: 'mystic', stellar: 'mystic', spirit: 'mystic',
                ocean: 'nature', earth: 'nature', flame: 'dragon', frost: 'dragon', thunder: 'dragon',
                void: 'genesis', ancient: 'genesis', destiny: 'genesis', chaos: 'genesis'
            };

            const resolvedType = petTemplates[choiceType] ? choiceType : (typeMap[choiceType] || 'nature');
            const template = petTemplates[resolvedType];
            const species = template.species[Math.floor(Math.random() * template.species.length)];
            const attribute = template.attributes[Math.floor(Math.random() * template.attributes.length)];
            const special = template.specials[Math.floor(Math.random() * template.specials.length)];

            const rarityMultiplier = {
                'LEGEND': 2.5, 'SSS': 2.0, 'SSR': 1.5, 'SR': 1.3, 'R': 1.1, 'N': 1.0
            };
            
            const multiplier = rarityMultiplier[rarity];
            
            return {
                id: Date.now().toString(),
                name: `${species}*${attribute}*${special}`,
                species: species,
                attribute: attribute,
                special: special,
                rarity: rarity,
                rarityClass: rarityClass,
                emoji: template.emoji,
                attributes: {
                    hp: Math.floor((80 + Math.floor(Math.random() * 40)) * multiplier),
                    attack: Math.floor((15 + Math.floor(Math.random() * 20)) * multiplier),
                    defense: Math.floor((10 + Math.floor(Math.random() * 15)) * multiplier),
                    speed: Math.floor((8 + Math.floor(Math.random() * 12)) * multiplier),
                    magic: Math.floor((12 + Math.floor(Math.random() * 18)) * multiplier)
                }
            };
        }

        // æ˜¾ç¤ºå® ç‰©æ•…äº‹
        function showPetStory(pet) {
            const nameParts = pet.name.split('*');
            const baseName = nameParts[0] || pet.name;
            const attribute = nameParts[1] || 'æœªçŸ¥';
            const special = nameParts[2] || 'æ™®é€š';
            
            pet.displayName = `${baseName}(${attribute}Â·${special})`;

            // AIç”Ÿæˆä¸°å¯Œçš„å® ç‰©æ•…äº‹å†…å®¹
            const aiStoryContent = generateAIPetStory(pet);

            const storyLines = [
                { text: `âœ¦ â€» ä¸–ç•Œæ ‘ â€» çš„å…‰èŠ’é—ªçƒï¼Œ${pet.displayName} å‡ºç°åœ¨ä½ é¢å‰ï¼`, class: "title" },
                { text: `â—‰ å¤–è§‚æè¿° â—‰ï¼š${aiStoryContent.appearance}`, class: "normal" },
                { text: `â—‰ æ€§æ ¼åˆ†æ â—‰ï¼š${aiStoryContent.personality}`, class: "normal" },
                { text: `â—‰ èƒŒæ™¯æ•…äº‹ â—‰ï¼š${aiStoryContent.background}`, class: "normal" },
                { text: `â—‰ äº’åŠ¨å»ºè®® â—‰ï¼š${aiStoryContent.suggestion}`, class: "normal" },
                { text: "é€‰æ‹©ä½ ä»¬çš„ç¬¬ä¸€æ¬¡äº’åŠ¨æ–¹å¼ï¼š", class: "normal" }
            ];

            const storyContent = document.getElementById('storyContent');
            showStoryLinesWithClasses(storyLines, storyContent, () => {
                showAIInteractionChoices(pet);
            });
        }

        // AIç”Ÿæˆå® ç‰©æ•…äº‹å†…å®¹
        function generateAIPetStory(pet) {
            const appearanceTemplates = [
                `è¿™åª ${pet.species} èº«æŠ« ${pet.attribute} ä¹‹åŠ›çš„å…‰è¾‰ï¼Œ${pet.special} çš„æ°”è´¨è®©äººè¿‡ç›®éš¾å¿˜ã€‚å®ƒçš„çœ¼ä¸­é—ªçƒç€æ™ºæ…§çš„å…‰èŠ’ã€‚`,
                `${pet.species} çš„èº«å½¢åœ¨ ${pet.attribute} èƒ½é‡çš„åŒ…å›´ä¸‹æ˜¾å¾—æ ¼å¤–ç¥ç§˜ï¼Œæ•£å‘ç€ ${pet.special} çš„å¨ä¸¥ï¼Œä»¿ä½›æ¥è‡ªå¦ä¸€ä¸ªä¸–ç•Œã€‚`,
                `çœ¼å‰çš„ ${pet.species} æµ‘èº«é—ªçƒç€ ${pet.attribute} çš„å…‰èŠ’ï¼Œ${pet.special} çš„åŠ›é‡åœ¨å…¶å‘¨å›´æµè½¬ï¼Œå±•ç°å‡ºéå‡¡çš„å­˜åœ¨æ„Ÿã€‚`
            ];

            const personalityTemplates = [
                `æ€§æ ¼æ¸©å’Œè€Œåšå®šï¼Œæ˜¯å¤©ç”Ÿçš„ â€» å®ˆæŠ¤è€… â€»ã€‚å®ƒèƒ½æ„ŸçŸ¥ä½ å†…å¿ƒçš„å–„æ„ï¼Œæ„¿æ„ä¸çœŸè¯šçš„äººå»ºç«‹æ·±åšçš„ç¾ç»Šã€‚`,
                `è¿™åªçµå…½æ€§æƒ…é«˜å‚²è€Œç‹¬ç«‹ï¼Œåªæœ‰çœŸæ­£çš„å¼ºè€…æ‰èƒ½è·å¾—å®ƒçš„è®¤å¯ã€‚å®ƒçš„æ™ºæ…§è¶…è¶Šå¸¸äººï¼Œæ˜¯ç†æƒ³çš„ â—‰ æˆ˜ç•¥ä¼™ä¼´ â—‰ã€‚`,
                `æ—¢ç¥ç§˜åˆäº²è¿‘ï¼Œä»¿ä½›èƒ½æ´å¯Ÿä¸€åˆ‡ã€‚å®ƒæ˜¾å¾—æ—¢å¤è€åˆå¹´è½»ï¼Œæ‰¿è½½ç€æ— æ•°çš„ç§˜å¯†å’Œæ™ºæ…§ã€‚`
            ];

            const backgroundTemplates = [
                `æ® â€» ä¸–ç•Œæ ‘ â€» çš„è®°å¿†æ˜¾ç¤ºï¼Œè¿™åª ${pet.species} æ¥è‡ª â—‰ æ˜†ä»‘å±± â—‰ï¼Œæ›¾æ˜¯å¤ä»£ä¼ è¯´ä¸­çš„å­˜åœ¨ï¼Œå®ˆæŠ¤ç€é‡è¦çš„ç§˜å¯†ã€‚`,
                `åœ¨é¥è¿œçš„è¿‡å»ï¼Œ${pet.species} ä¸€æ—æ˜¯ â€» ä¸–ç•Œæ ‘ â€» çš„å®ˆæŠ¤è€…ï¼Œæ‹¥æœ‰è¿æ¥ä¸åŒä¸–ç•Œçš„ç¥ç§˜åŠ›é‡ã€‚`,
                `è¿™åª ${pet.species} æ‰¿è½½ç€å¤è€çš„ä½¿å‘½ï¼Œå®ƒçš„å‡ºç°é¢„ç¤ºç€æ–°çš„å†’é™©å³å°†å¼€å§‹ã€‚`
            ];

            const suggestionTemplates = [
                `å»ºè®®ä»¥æ¸©å’Œçš„æ–¹å¼æ¥è¿‘ï¼Œå®ƒä¼šå›åº”ä½ çš„å–„æ„ã€‚å¯ä»¥å°è¯•å¿ƒçµæ²Ÿé€šæˆ–è€…ç®€å•çš„è‚¢ä½“æ¥è§¦ã€‚`,
                `ä¿æŒå°Šé‡çš„è·ç¦»ï¼Œè§‚å¯Ÿå®ƒçš„è¡Œä¸ºæ¨¡å¼ã€‚è¿™ç±»çµå…½éœ€è¦æ—¶é—´æ¥è¯„ä¼°ä¼™ä¼´çš„ä»·å€¼ã€‚`,
                `å¯ä»¥ç›´æ¥è¿›è¡Œæ·±åº¦äº¤æµï¼Œå®ƒçš„æ™ºæ…§è¶³ä»¥ç†è§£å¤æ‚çš„æ¦‚å¿µå’Œæƒ…æ„Ÿã€‚`
            ];

            return {
                appearance: appearanceTemplates[Math.floor(Math.random() * appearanceTemplates.length)],
                personality: personalityTemplates[Math.floor(Math.random() * personalityTemplates.length)],
                background: backgroundTemplates[Math.floor(Math.random() * backgroundTemplates.length)],
                suggestion: suggestionTemplates[Math.floor(Math.random() * suggestionTemplates.length)]
            };
        }

        // æ˜¾ç¤ºAIäº’åŠ¨é€‰æ‹©
        function showAIInteractionChoices(pet) {
            const choices = [
                { 
                    text: "â—‰ æ¸©å’Œæ¥è§¦ â—‰", 
                    description: "è½»æŸ”åœ°ä¸çµå® å»ºç«‹åˆæ­¥è”ç³»",
                    action: () => startAIInteraction(pet, 'gentle')
                },
                { 
                    text: "â—‰ è§‚å¯Ÿè¡Œä¸º â—‰", 
                    description: "ä»”ç»†è§‚å¯Ÿçµå® çš„è¡Œä¸ºæ¨¡å¼å’Œç‰¹å¾",
                    action: () => startAIInteraction(pet, 'observe')
                },
                { 
                    text: "â—‰ å¿ƒçµè¿æ¥ â—‰", 
                    description: "å°è¯•ä¸çµå® å»ºç«‹æ·±å±‚çš„å¿ƒçµæ²Ÿé€š",
                    action: () => startAIInteraction(pet, 'communicate')
                }
            ];

            const choicesContainer = document.getElementById('choicesContainer');
            choicesContainer.innerHTML = '';
            
            choices.forEach((choice, index) => {
                setTimeout(() => {
                    const button = document.createElement('button');
                    button.className = 'choice-button';
                    button.innerHTML = `${applySpecialMarkers(choice.text)}<br><small style="opacity:0.7;font-size:0.8em;">${choice.description}</small>`;
                    button.addEventListener('click', choice.action);
                    button.style.opacity = '0';
                    button.style.transform = 'translateY(20px)';
                    choicesContainer.appendChild(button);
                    
                    setTimeout(() => {
                        button.style.transition = 'all 0.8s ease';
                        button.style.opacity = '1';
                        button.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 300);
            });

            choicesContainer.style.display = 'block';
            setTimeout(() => {
                choicesContainer.classList.add('show');
            }, 500);
        }

        // å¼€å§‹AIäº’åŠ¨
        function startAIInteraction(pet, interactionType) {
            const aiResponse = generateAIInteractionResponse(pet, interactionType);
            
            const responseLines = [
                { text: `â—‰ å®æ—¶ååº” â—‰ï¼š${aiResponse.petReaction}`, class: "normal" },
                { text: `â—‰ æ·±åº¦åˆ†æ â—‰ï¼š${aiResponse.analysis}`, class: "normal" },
                { text: `â—‰ ç­–ç•¥å»ºè®® â—‰ï¼š${aiResponse.strategy}`, class: "normal" },
                { text: "ç»§ç»­ä½ ä»¬çš„å†’é™©ï¼š", class: "normal" }
            ];

            const storyContent = document.getElementById('storyContent');
            showStoryLinesWithClasses(responseLines, storyContent, () => {
                showAIGameModes(pet);
            });
        }

        // AIç”Ÿæˆäº’åŠ¨å“åº”
        function generateAIInteractionResponse(pet, interactionType) {
            const responses = {
                gentle: {
                    petReaction: `${pet.displayName} è½»è½»è¹­äº†è¹­ä½ çš„æ‰‹ï¼Œçœ¼ä¸­é—ªè¿‡æ¸©æš–çš„å…‰èŠ’ã€‚${pet.attribute} çš„èƒ½é‡åœ¨æ¥è§¦ç‚¹è½»æŸ”åœ°æµè½¬ã€‚`,
                    analysis: `è¿™åª ${pet.species} è¡¨ç°å‡ºé«˜åº¦çš„äº²å’ŒåŠ›å’Œä¿¡ä»»åº¦ã€‚å…¶ ${pet.special} ç‰¹è´¨ä½¿å®ƒèƒ½å¤Ÿå¿«é€Ÿè¯†åˆ«å–„æ„ã€‚`,
                    strategy: `å»ºè®®ç»§ç»­æ¸©å’Œäº’åŠ¨ï¼Œå¯ä»¥å°è¯•æ›´æ·±å…¥çš„æƒ…æ„Ÿäº¤æµã€‚è¿™ç§ç±»å‹çš„å® ç‰©é€‚åˆé•¿æœŸåŸ¹å…»å…³ç³»ã€‚`
                },
                observe: {
                    petReaction: `${pet.displayName} æ³¨æ„åˆ°ä½ çš„è§‚å¯Ÿï¼Œå¼€å§‹æœ‰æ„è¯†åœ°å±•ç¤ºè‡ªå·±çš„èƒ½åŠ›ã€‚${pet.attribute} çš„åŠ›é‡åœ¨å®ƒå‘¨å›´å½¢æˆç¾ä¸½çš„å…‰ç¯ã€‚`,
                    analysis: `è¿™åª ${pet.species} å…·æœ‰é«˜æ™ºå•†å’Œå¼ºçƒˆçš„è‡ªæˆ‘æ„è¯†ã€‚å®ƒç†è§£è¢«è§‚å¯Ÿçš„æ„ä¹‰å¹¶åšå‡ºç›¸åº”ååº”ã€‚`,
                    strategy: `å¯ä»¥è¿›è¡Œæ›´å¤æ‚çš„äº’åŠ¨æµ‹è¯•ã€‚è¿™ç±»å® ç‰©é€‚åˆæˆ˜ç•¥æ€§åŸ¹å…»å’ŒæŠ€èƒ½å¼€å‘ã€‚`
                },
                communicate: {
                    petReaction: `ä½ æ„Ÿå—åˆ°æ¸©æš–çš„æ„å¿µæ³¢åŠ¨ï¼Œ${pet.displayName} æ­£åœ¨å°è¯•ä¸ä½ å»ºç«‹å¿ƒçµè¿æ¥ã€‚ä½ ä»¬ä¹‹é—´ä¼¼ä¹æœ‰äº†æŸç§å…±é¸£ã€‚`,
                    analysis: `è¿™åª ${pet.species} æ‹¥æœ‰å¼ºå¤§çš„ç²¾ç¥åŠ›é‡å’Œæ²Ÿé€šèƒ½åŠ›ã€‚${pet.special} çš„ç‰¹è´¨å¢å¼ºäº†å®ƒçš„æ„ŸçŸ¥èƒ½åŠ›ã€‚`,
                    strategy: `å¿ƒçµè¿æ¥å·²å»ºç«‹ï¼Œå¯ä»¥å°è¯•æ›´é«˜çº§çš„åˆä½œæ¨¡å¼ã€‚è¿™ç§ç¾ç»Šå°†å¤§å¤§æå‡æˆ˜æ–—å’Œæ¢ç´¢æ•ˆç‡ã€‚`
                }
            };

            return responses[interactionType] || responses.gentle;
        }

        // æ˜¾ç¤ºAIæ¸¸æˆæ¨¡å¼
        function showAIGameModes(pet) {
            const modes = [
                { 
                    text: "â—‰ å†’é™©æ¨¡å¼ â—‰", 
                    description: "ä½“éªŒåŠ¨æ€å†’é™©äº‹ä»¶å’Œæ™ºèƒ½NPCäº’åŠ¨",
                    action: () => startAIAdventure(pet)
                },
                { 
                    text: "â—‰ è®­ç»ƒæ¨¡å¼ â—‰", 
                    description: "åˆ¶å®šä¸ªæ€§åŒ–è®­ç»ƒè®¡åˆ’å’Œæˆé•¿è·¯å¾„",
                    action: () => startAITraining(pet)
                },
                { 
                    text: "â—‰ æ¢ç´¢æ¨¡å¼ â—‰", 
                    description: "æ¢ç´¢ç¥ç§˜ä¸–ç•Œå’Œéšè—å‰§æƒ…",
                    action: () => startAIExploration(pet)
                }
            ];

            const choicesContainer = document.getElementById('choicesContainer');
            choicesContainer.innerHTML = '';
            
            modes.forEach((mode, index) => {
                setTimeout(() => {
                    const button = document.createElement('button');
                    button.className = 'choice-button';
                    button.innerHTML = `${applySpecialMarkers(mode.text)}<br><small style="opacity:0.7;font-size:0.8em;">${mode.description}</small>`;
                    button.addEventListener('click', mode.action);
                    button.style.opacity = '0';
                    button.style.transform = 'translateY(20px)';
                    choicesContainer.appendChild(button);
                    
                    setTimeout(() => {
                        button.style.transition = 'all 0.8s ease';
                        button.style.opacity = '1';
                        button.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 300);
            });

            choicesContainer.style.display = 'block';
            setTimeout(() => {
                choicesContainer.classList.add('show');
            }, 500);
        }

        // AIå†’é™©æ¨¡å¼
        function startAIAdventure(pet) {
            const adventureEvent = generateAIAdventureEvent(pet);
            
            const eventLines = [
                { text: `â—‰ äº‹ä»¶å‘ç”Ÿ â—‰ï¼š${adventureEvent.title}`, class: "title" },
                { text: `â—‰ åœºæ™¯æè¿° â—‰ï¼š${adventureEvent.description}`, class: "normal" },
                { text: `â—‰ è§’è‰²å¯¹è¯ â—‰ï¼š${adventureEvent.npcDialogue}`, class: "normal" },
                { text: "é€‰æ‹©ä½ çš„è¡ŒåŠ¨ï¼š", class: "normal" }
            ];

            const storyContent = document.getElementById('storyContent');
            showStoryLinesWithClasses(eventLines, storyContent, () => {
                showAIAdventureChoices(pet, adventureEvent);
            });
        }

        // ç”ŸæˆAIå†’é™©äº‹ä»¶
        function generateAIAdventureEvent(pet) {
            const events = [
                {
                    title: "ç¥ç§˜å•†äººçš„é‚€è¯·",
                    description: `åœ¨ â—‰ æ˜†ä»‘å±± â—‰ çš„è¾¹ç¼˜ï¼Œä½ ä»¬é‡åˆ°äº†ä¸€ä½ç¥ç§˜çš„å•†äººã€‚ä»–çš„è´§ç‰©æ•£å‘ç€å¥‡å¼‚çš„å…‰èŠ’ã€‚`,
                    npcDialogue: `"å¹´è½»çš„æ—…è€…ï¼Œæˆ‘çœ‹å‡ºä½ çš„ ${pet.species} å¾ˆä¸å¯»å¸¸ã€‚æˆ‘è¿™é‡Œæœ‰äº›ç‰¹æ®Šçš„ç‰©å“ï¼Œæˆ–è®¸å¯¹ä½ ä»¬æœ‰ç”¨..."`
                },
                {
                    title: "è¿œå¤é—è¿¹çš„å‘ç°",
                    description: `${pet.displayName} çš„ ${pet.attribute} åŠ›é‡ä¸ä¸€å¤„è¿œå¤é—è¿¹äº§ç”Ÿäº†å…±é¸£ï¼ŒçŸ³é—¨ç¼“ç¼“å¼€å¯ã€‚`,
                    npcDialogue: `é—è¿¹ä¸­ä¼ æ¥å¤è€çš„å£°éŸ³ï¼š"æ‹¥æœ‰ ${pet.special} ä¹‹åŠ›çš„å­˜åœ¨ï¼Œä½ ä»¬æœ‰èµ„æ ¼æ¥å—è¯•ç‚¼..."`
                },
                {
                    title: "è¿·å¤±æ—…è€…çš„æ±‚åŠ©",
                    description: `ä¸€ä½è¿·å¤±çš„æ—…è€…å‘ä½ ä»¬æ±‚åŠ©ï¼Œä½†ä»–çš„èº«ä¸Šæ•£å‘ç€ä¸å¯»å¸¸çš„æ°”æ¯ã€‚`,
                    npcDialogue: `"è¯·å¸®å¸®æˆ‘ï¼æˆ‘åœ¨è¿™é‡Œè¿·è·¯äº†å¥½ä¹…...ä½ çš„ ${pet.species} çœ‹èµ·æ¥å¾ˆå¼ºå¤§ï¼Œä¸€å®šèƒ½å¸®åˆ°æˆ‘ï¼"`
                }
            ];

            return events[Math.floor(Math.random() * events.length)];
        }

        // æ˜¾ç¤ºAIå†’é™©é€‰æ‹©
        function showAIAdventureChoices(pet, event) {
            const choices = [
                { 
                    text: "â—‰ æ™ºèƒ½åˆ†æ â—‰ è°¨æ…åº”å¯¹", 
                    description: "ä»”ç»†åˆ†æé£é™©å¹¶åˆ¶å®šæœ€ä¼˜ç­–ç•¥"
                },
                { 
                    text: "â—‰ æˆ˜æ–—é¢„æµ‹ â—‰ ç›´æ¥è¡ŒåŠ¨", 
                    description: "è®¡ç®—æˆ˜æ–—ç»“æœå’Œæ½œåœ¨æ”¶ç›Š"
                },
                { 
                    text: "â—‰ å¤–äº¤æ²Ÿé€š â—‰ å°è¯•å¯¹è¯", 
                    description: "é€šè¿‡å¯¹è¯å¯»æ‰¾å’Œå¹³è§£å†³æ–¹æ¡ˆ"
                }
            ];

            const choicesContainer = document.getElementById('choicesContainer');
            choicesContainer.innerHTML = '';
            
            choices.forEach((choice, index) => {
                setTimeout(() => {
                    const button = document.createElement('button');
                    button.className = 'choice-button';
                    button.innerHTML = `${applySpecialMarkers(choice.text)}<br><small style="opacity:0.7;font-size:0.8em;">${choice.description}</small>`;
                    button.addEventListener('click', () => {
                        showAIResult(pet, choice.text);
                    });
                    button.style.opacity = '0';
                    button.style.transform = 'translateY(20px)';
                    choicesContainer.appendChild(button);
                    
                    setTimeout(() => {
                        button.style.transition = 'all 0.8s ease';
                        button.style.opacity = '1';
                        button.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 300);
            });

            choicesContainer.style.display = 'block';
            setTimeout(() => {
                choicesContainer.classList.add('show');
            }, 500);
        }

        // æ˜¾ç¤ºAIç»“æœ
        function showAIResult(pet, choiceType) {
            const results = [
                `â—‰ ç»“æœæ˜¾ç¤º â—‰ï¼šä½ çš„é€‰æ‹©è·å¾—äº†æ„æƒ³ä¸åˆ°çš„æˆåŠŸï¼${pet.displayName} çš„èƒ½åŠ›å¾—åˆ°äº†æå‡ã€‚`,
                `â—‰ ç»éªŒæ€»ç»“ â—‰ï¼šé€šè¿‡è¿™æ¬¡å†’é™©ï¼Œä½ ä»¬çš„ç¾ç»Šå˜å¾—æ›´åŠ æ·±åšï¼Œè§£é”äº†æ–°çš„æŠ€èƒ½ç»„åˆã€‚`,
                `â—‰ å¥–åŠ±è·å¾— â—‰ï¼šè·å¾—äº†çè´µçš„ â€» ä¸–ç•Œæ ‘æœå® â€»ï¼Œå¯ä»¥ç”¨äºå¼ºåŒ–å® ç‰©çš„æ ¸å¿ƒå±æ€§ã€‚`
            ];

            const storyContent = document.getElementById('storyContent');
            const resultLines = results.map(text => ({ text, class: "normal" }));
            
            showStoryLinesWithClasses(resultLines, storyContent, () => {
                showAIGameModes(pet);
            });
        }

        // AIè®­ç»ƒæ¨¡å¼
        function startAITraining(pet) {
            const trainingPlan = generateAITrainingPlan(pet);
            
            const planLines = [
                { text: `â—‰ è®­ç»ƒè®¡åˆ’ â—‰ï¼š${trainingPlan.title}`, class: "title" },
                { text: `â—‰ èƒ½åŠ›è¯„ä¼° â—‰ï¼š${trainingPlan.assessment}`, class: "normal" },
                { text: `â—‰ æˆé•¿å»ºè®® â—‰ï¼š${trainingPlan.recommendation}`, class: "normal" }
            ];

            const storyContent = document.getElementById('storyContent');
            showStoryLinesWithClasses(planLines, storyContent, () => {
                showAIGameModes(pet);
            });
        }

        // ç”ŸæˆAIè®­ç»ƒè®¡åˆ’
        function generateAITrainingPlan(pet) {
            return {
                title: `ä¸º ${pet.species} åˆ¶å®šçš„ä¸“å±è®­ç»ƒæ–¹æ¡ˆ`,
                assessment: `åŸºäº ${pet.attribute} å±æ€§å’Œ ${pet.special} ç‰¹è´¨ï¼Œè¿™åªå® ç‰©åœ¨æˆ˜æ–—å’Œæ¢ç´¢æ–¹é¢éƒ½æœ‰å¾ˆå¤§æ½œåŠ›ã€‚`,
                recommendation: `å»ºè®®é‡ç‚¹åŸ¹å…»å…¶ ${pet.attribute} èƒ½åŠ›ï¼ŒåŒæ—¶åŠ å¼ºä¸ä¸»äººçš„å¿ƒçµè¿æ¥è®­ç»ƒã€‚`
            };
        }

        // AIæ¢ç´¢æ¨¡å¼
        function startAIExploration(pet) {
            const explorationEvent = generateAIExplorationEvent(pet);
            
            const eventLines = [
                { text: `â—‰ ä¸–ç•Œæ¢ç´¢ â—‰ï¼š${explorationEvent.title}`, class: "title" },
                { text: `â—‰ ç¯å¢ƒæè¿° â—‰ï¼š${explorationEvent.description}`, class: "normal" },
                { text: `â—‰ éšè—å‰§æƒ… â—‰ï¼š${explorationEvent.secret}`, class: "normal" }
            ];

            const storyContent = document.getElementById('storyContent');
            showStoryLinesWithClasses(eventLines, storyContent, () => {
                showAIGameModes(pet);
            });
        }

        // ç”ŸæˆAIæ¢ç´¢äº‹ä»¶
        function generateAIExplorationEvent(pet) {
            const events = [
                {
                    title: "ç¥ç§˜çš„æ˜Ÿè¾°æµ·",
                    description: `ä½ ä»¬æ¥åˆ°äº†ä¼ è¯´ä¸­çš„ â—‰ æ˜Ÿè¾°æµ· â—‰ï¼Œè¿™é‡Œçš„æ¯ä¸€æ»´æ°´éƒ½è•´å«ç€æ˜Ÿè¾°çš„åŠ›é‡ã€‚`,
                    secret: `${pet.displayName} ä¼¼ä¹å¯¹è¿™é‡Œå¾ˆç†Ÿæ‚‰ï¼Œå®ƒçš„è®°å¿†ä¸­è—ç€å…³äºè¿™ç‰‡æµ·åŸŸçš„å¤è€ç§˜å¯†...`
                },
                {
                    title: "ä¸–ç•Œæ ‘çš„æ ¹é¡»",
                    description: `åœ¨åœ°åº•æ·±å¤„ï¼Œä½ ä»¬å‘ç°äº† â€» ä¸–ç•Œæ ‘ â€» çš„å·¨å¤§æ ¹é¡»ï¼Œæ•£å‘ç€ç”Ÿå‘½çš„å…‰è¾‰ã€‚`,
                    secret: `è¿™é‡Œéšè—ç€åˆ›ä¸–çš„å¥¥ç§˜ï¼Œåªæœ‰æ‹¥æœ‰ç‰¹æ®Šè¡€ç»Ÿçš„ç”Ÿçµæ‰èƒ½æ„ŸçŸ¥åˆ°å…¶ä¸­çš„çœŸç›¸ã€‚`
                }
            ];

            return events[Math.floor(Math.random() * events.length)];
        }

        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            const storyContent = document.getElementById('storyContent');
            storyContent.innerHTML = `<div class="story-line normal show" style="color: #ff6b6b;">${message}</div>`;
        }

        // å¼€å§‹æ•…äº‹
        function startStory() {
            const introLines = [
                { text: "å±±æµ·ç»çµå¢ƒæ–—å® å½•", class: "title" },
                { text: "åœ¨è¿™ä¸ªç”± â€» ä¸–ç•Œæ ‘ â€» æ”¯æ’‘çš„ç¥è¯ä¸–ç•Œä¸­ï¼Œå¤è€çš„ä¼ è¯´æ­£åœ¨è‹é†’...", class: "normal" },
                { text: "ä½ ç«™åœ¨ â—‰ ä¸–ç•Œæ ‘ â—‰ çš„æ ¹éƒ¨ï¼Œæ„Ÿå—ç€æ¥è‡ªä¸åŒæ–¹å‘çš„ç¥ç§˜å¬å”¤ã€‚", class: "normal" },
                { text: "è¯·é€‰æ‹©ä½ æ„Ÿåº”åˆ°çš„åŠ›é‡ï¼š", class: "normal" }
            ];

            const storyContent = document.getElementById('storyContent');
            showStoryLinesWithClasses(introLines, storyContent, () => {
                showChoices();
            });
        }

        // é‡æ–°å¼€å§‹
        function restartGame() {
            gameState.currentPet = null;
            gameState.petCount = 0;
            gameState.bestRarity = '-';
            gameState.evolutionCount = 0;
            
            const storyContent = document.getElementById('storyContent');
            const choicesContainer = document.getElementById('choicesContainer');
            
            storyContent.innerHTML = '<div class="loading">æ­£åœ¨å”¤é†’ä¸–ç•Œæ ‘çš„è®°å¿†</div>';
            choicesContainer.innerHTML = '';
            choicesContainer.style.display = 'none';
            
            setTimeout(() => {
                startStory();
            }, 1000);
        }

        // äº‹ä»¶ç›‘å¬
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('btnStoryStart').addEventListener('click', startStory);
            document.getElementById('btnRestart').addEventListener('click', restartGame);
            document.getElementById('btnPanel').addEventListener('click', () => {
                alert('é¢æ¿åŠŸèƒ½å¼€å‘ä¸­...');
            });
        });
    </script>
</body>
</html>