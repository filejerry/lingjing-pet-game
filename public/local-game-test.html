<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å±±æµ·ç»çµå¢ƒæ–—å® å½• - æµ‹è¯•ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 2.5em;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            color: #ccc;
            margin-bottom: 20px;
        }

        .game-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .panel h3 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .btn {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #4a90e2, #7bb3f0);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #f39c12);
            color: white;
        }

        .status-panel {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #ffd700;
        }

        .pet-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }

        .pet-stat {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            border-radius: 5px;
            text-align: center;
        }

        .story-panel {
            grid-column: 1 / -1;
            min-height: 300px;
        }

        .story-content {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
            line-height: 1.6;
        }

        .choices {
            margin-top: 20px;
        }

        .choice-btn {
            display: block;
            width: 100%;
            margin: 10px 0;
            text-align: left;
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .choice-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: #ffd700;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #ffd700;
        }

        .error {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .success {
            color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .exp-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .exp-fill {
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            height: 100%;
            transition: width 0.5s ease;
        }

        .api-test {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
        }

        .api-result {
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .game-panel {
                grid-template-columns: 1fr;
            }
            
            .title {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ğŸ‰ å±±æµ·ç»çµå¢ƒæ–—å® å½• ğŸ‰</h1>
            <p class="subtitle">å½±æ¸¸å¼å‰§æƒ…åˆ†æ”¯ Ã— å®å¯æ¢¦å¼å…»æˆç³»ç»Ÿ</p>
            <div class="status-panel">
                <div id="serverStatus">ğŸ”„ æ­£åœ¨è¿æ¥æœåŠ¡å™¨...</div>
            </div>
        </div>

        <div class="game-panel">
            <!-- å® ç‰©çŠ¶æ€é¢æ¿ -->
            <div class="panel">
                <h3>ğŸ¾ æˆ‘çš„å® ç‰©</h3>
                <div id="petPanel">
                    <div class="pet-info">
                        <div class="pet-stat">
                            <div>åç§°</div>
                            <div id="petName">ç«è‹—é¾™</div>
                        </div>
                        <div class="pet-stat">
                            <div>ç­‰çº§</div>
                            <div id="petLevel">1</div>
                        </div>
                        <div class="pet-stat">
                            <div>ç»éªŒå€¼</div>
                            <div id="petExp">0 / 100</div>
                        </div>
                        <div class="pet-stat">
                            <div>ç¾ç»Šå€¼</div>
                            <div id="petBond">10</div>
                        </div>
                    </div>
                    <div class="exp-bar">
                        <div class="exp-fill" id="expBar" style="width: 0%"></div>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-secondary" onclick="addExperience()">ğŸ¯ è·å¾—ç»éªŒ</button>
                        <button class="btn btn-secondary" onclick="checkEvolution()">ğŸ”¥ æ£€æŸ¥è¿›åŒ–</button>
                        <button class="btn btn-secondary" onclick="getPetStatus()">ğŸ“Š æŸ¥çœ‹çŠ¶æ€</button>
                    </div>
                </div>
            </div>

            <!-- å‰§æƒ…æ§åˆ¶é¢æ¿ -->
            <div class="panel">
                <h3>ğŸŒ³ å‰§æƒ…ç³»ç»Ÿ</h3>
                <div id="storyPanel">
                    <button class="btn" onclick="startStory('shanhai_exploration')">ğŸ”ï¸ å±±æµ·ç»æ¢ç´¢</button>
                    <button class="btn" onclick="startStory('pet_growth')">ğŸ’ª å® ç‰©æˆé•¿</button>
                    <button class="btn" onclick="startStory('battle_scenarios')">âš”ï¸ æˆ˜æ–—è¯•ç‚¼</button>
                    <button class="btn btn-secondary" onclick="getCurrentStory()">ğŸ“– å½“å‰å‰§æƒ…</button>
                    <button class="btn btn-secondary" onclick="getAvailableStories()">ğŸ“š å¯ç”¨æ•…äº‹</button>
                </div>
            </div>

            <!-- å‰§æƒ…æ˜¾ç¤ºé¢æ¿ -->
            <div class="panel story-panel">
                <h3>ğŸ“œ å‰§æƒ…å†…å®¹</h3>
                <div id="storyContent">
                    <div class="story-content">
                        <p>æ¬¢è¿æ¥åˆ°å±±æµ·ç»çš„ç¥ç§˜ä¸–ç•Œï¼åœ¨è¿™é‡Œï¼Œä½ å°†ä¸ç¥è¯ç”Ÿç‰©ä¸ºä¼´ï¼Œä½“éªŒå½±æ¸¸å¼çš„å‰§æƒ…åˆ†æ”¯ï¼Œè§è¯å® ç‰©çš„æˆé•¿ä¸è¿›åŒ–ã€‚</p>
                        <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹ä½ çš„å†’é™©ä¹‹æ—…å§ï¼</p>
                    </div>
                </div>
                <div id="storyChoices" class="choices"></div>
            </div>
        </div>

        <!-- APIæµ‹è¯•é¢æ¿ -->
        <div class="panel">
            <h3>ğŸ”§ ç³»ç»Ÿæµ‹è¯•</h3>
            <div class="api-test">
                <button class="btn btn-secondary" onclick="testHealth()">ğŸ¥ å¥åº·æ£€æŸ¥</button>
                <button class="btn btn-secondary" onclick="testApiInfo()">â„¹ï¸ APIä¿¡æ¯</button>
                <button class="btn btn-secondary" onclick="testStoryGrowthAPI()">ğŸ§ª å‰§æƒ…æˆé•¿API</button>
                <button class="btn btn-danger" onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
                <div id="apiResults" class="api-result"></div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentPet = {
            name: 'ç«è‹—é¾™',
            species: 'ç«è‹—é¾™',
            level: 1,
            totalExp: 0,
            bond: 10,
            attribute: 'fire',
            stats: {
                hp: 45,
                attack: 49,
                defense: 49,
                speed: 45,
                magic: 65
            }
        };

        let currentPlayerId = 'player_' + Date.now();

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            checkServerStatus();
            updatePetDisplay();
        });

        // æœåŠ¡å™¨çŠ¶æ€æ£€æŸ¥
        async function checkServerStatus() {
            try {
                const response = await fetch('/health');
                const data = await response.json();
                document.getElementById('serverStatus').innerHTML = 'âœ… æœåŠ¡å™¨è¿æ¥æ­£å¸¸';
                document.getElementById('serverStatus').style.color = '#27ae60';
                console.log('æœåŠ¡å™¨çŠ¶æ€:', data);
            } catch (error) {
                document.getElementById('serverStatus').innerHTML = 'âŒ æœåŠ¡å™¨è¿æ¥å¤±è´¥';
                document.getElementById('serverStatus').style.color = '#e74c3c';
                console.error('æœåŠ¡å™¨è¿æ¥é”™è¯¯:', error);
            }
        }

        // æ›´æ–°å® ç‰©æ˜¾ç¤º
        function updatePetDisplay() {
            document.getElementById('petName').textContent = currentPet.name;
            document.getElementById('petLevel').textContent = currentPet.level;
            document.getElementById('petBond').textContent = currentPet.bond;
            
            // è®¡ç®—ç»éªŒå€¼æ˜¾ç¤º
            const expForCurrentLevel = Math.pow(currentPet.level, 3) * 0.8;
            const expForNextLevel = Math.pow(currentPet.level + 1, 3) * 0.8;
            const expInLevel = currentPet.totalExp - expForCurrentLevel;
            const expNeeded = expForNextLevel - expForCurrentLevel;
            const expPercent = Math.max(0, Math.min(100, (expInLevel / expNeeded) * 100));
            
            document.getElementById('petExp').textContent = `${Math.floor(expInLevel)} / ${Math.floor(expNeeded)}`;
            document.getElementById('expBar').style.width = expPercent + '%';
        }

        // å¼€å§‹å‰§æƒ…
        async function startStory(storyType) {
            try {
                showLoading('æ­£åœ¨å¼€å§‹å‰§æƒ…...');
                
                const response = await fetch('/api/story-growth/stories/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        playerId: currentPlayerId,
                        storyType: storyType,
                        context: {
                            petName: currentPet.name,
                            level: currentPet.level,
                            bond: currentPet.bond,
                            courage: 3,
                            wisdom: 2
                        }
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    displayStoryNode(data.result.currentNode);
                    logResult('å‰§æƒ…å¼€å§‹æˆåŠŸ', data);
                } else {
                    showError('å‰§æƒ…å¼€å§‹å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('å‰§æƒ…å¼€å§‹é”™è¯¯: ' + error.message);
                console.error('å‰§æƒ…å¼€å§‹é”™è¯¯:', error);
            }
        }

        // æ˜¾ç¤ºå‰§æƒ…èŠ‚ç‚¹
        function displayStoryNode(node) {
            const storyContent = document.getElementById('storyContent');
            const storyChoices = document.getElementById('storyChoices');
            
            // æ˜¾ç¤ºå‰§æƒ…å†…å®¹
            storyContent.innerHTML = `
                <div class="story-content">
                    <h4 style="color: #ffd700; margin-bottom: 10px;">${node.title}</h4>
                    <p>${node.description}</p>
                </div>
            `;
            
            // æ˜¾ç¤ºé€‰æ‹©
            if (node.choices && node.choices.length > 0) {
                storyChoices.innerHTML = '<h4 style="color: #ffd700; margin-bottom: 10px;">é€‰æ‹©ä½ çš„è¡ŒåŠ¨ï¼š</h4>';
                
                node.choices.forEach(choice => {
                    const choiceBtn = document.createElement('button');
                    choiceBtn.className = 'choice-btn';
                    choiceBtn.innerHTML = `
                        <div style="font-weight: bold; margin-bottom: 5px;">${choice.text}</div>
                        ${choice.requirements ? `<div style="font-size: 0.9em; color: #ccc;">éœ€è¦: ${Object.entries(choice.requirements).map(([k,v]) => `${k} >= ${v}`).join(', ')}</div>` : ''}
                    `;
                    choiceBtn.onclick = () => makeChoice(choice.id);
                    storyChoices.appendChild(choiceBtn);
                });
            } else {
                storyChoices.innerHTML = '<p style="color: #ccc;">å‰§æƒ…ç»“æŸ</p>';
            }
        }

        // åšå‡ºé€‰æ‹©
        async function makeChoice(choiceId) {
            try {
                showLoading('æ­£åœ¨å¤„ç†é€‰æ‹©...');
                
                const response = await fetch('/api/story-growth/stories/choice', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        playerId: currentPlayerId,
                        choiceId: choiceId
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    if (data.result.nextNode) {
                        displayStoryNode(data.result.nextNode);
                    } else {
                        showSuccess('å‰§æƒ…å®Œæˆï¼');
                        document.getElementById('storyChoices').innerHTML = '<p style="color: #27ae60;">å‰§æƒ…å·²å®Œæˆï¼Œå¯ä»¥å¼€å§‹æ–°çš„å†’é™©äº†ï¼</p>';
                    }
                    
                    // æ˜¾ç¤ºæ•ˆæœ
                    if (data.result.effects) {
                        showEffects(data.result.effects);
                    }
                    
                    logResult('é€‰æ‹©å¤„ç†æˆåŠŸ', data);
                } else {
                    showError('é€‰æ‹©å¤„ç†å¤±è´¥: ' + (data.reason || data.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('é€‰æ‹©å¤„ç†é”™è¯¯: ' + error.message);
                console.error('é€‰æ‹©å¤„ç†é”™è¯¯:', error);
            }
        }

        // æ˜¾ç¤ºæ•ˆæœ
        function showEffects(effects) {
            const effectsText = Object.entries(effects).map(([key, value]) => {
                if (typeof value === 'number') {
                    return `${key}: ${value > 0 ? '+' : ''}${value}`;
                } else {
                    return `${key}: ${value}`;
                }
            }).join(', ');
            
            showSuccess(`è·å¾—æ•ˆæœ: ${effectsText}`);
            
            // æ›´æ–°å® ç‰©æ•°æ®
            if (effects.exp) {
                currentPet.totalExp += effects.exp;
            }
            if (effects.bond) {
                currentPet.bond += effects.bond;
            }
            
            updatePetDisplay();
        }

        // æ·»åŠ ç»éªŒå€¼
        async function addExperience() {
            try {
                const expGained = 25 + Math.floor(Math.random() * 25); // 25-50ç»éªŒ
                
                const response = await fetch('/api/story-growth/growth/add-exp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        pet: currentPet,
                        expGained: expGained
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    // æ›´æ–°å® ç‰©æ•°æ®
                    currentPet.totalExp = data.result.levelInfo.totalExp;
                    currentPet.level = data.result.levelInfo.level;
                    
                    updatePetDisplay();
                    
                    if (data.result.leveledUp) {
                        showSuccess(`ğŸ‰ å‡çº§äº†ï¼ä»${data.result.oldLevel}çº§å‡åˆ°${data.result.newLevel}çº§ï¼`);
                        
                        if (data.guidance) {
                            showGuidance(data.guidance);
                        }
                        
                        if (data.result.newSkills.length > 0) {
                            const skillsText = data.result.newSkills.map(s => s.skill.name).join(', ');
                            showSuccess(`âœ¨ å­¦ä¼šäº†æ–°æŠ€èƒ½: ${skillsText}`);
                        }
                    } else {
                        showSuccess(`è·å¾—äº†${expGained}ç‚¹ç»éªŒå€¼ï¼`);
                    }
                    
                    logResult('ç»éªŒå€¼æ·»åŠ æˆåŠŸ', data);
                } else {
                    showError('ç»éªŒå€¼æ·»åŠ å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('ç»éªŒå€¼æ·»åŠ é”™è¯¯: ' + error.message);
                console.error('ç»éªŒå€¼æ·»åŠ é”™è¯¯:', error);
            }
        }

        // æ˜¾ç¤ºå‡çº§å¼•å¯¼
        function showGuidance(guidance) {
            let guidanceText = guidance.congratulations + '\n\n';
            
            if (guidance.improvements.length > 0) {
                guidanceText += 'æå‡:\n' + guidance.improvements.join('\n') + '\n\n';
            }
            
            if (guidance.nextGoals.length > 0) {
                guidanceText += 'ä¸‹ä¸€ä¸ªç›®æ ‡:\n' + guidance.nextGoals.join('\n') + '\n\n';
            }
            
            if (guidance.tips.length > 0) {
                guidanceText += 'æç¤º:\n' + guidance.tips.join('\n');
            }
            
            alert(guidanceText);
        }

        // æ£€æŸ¥è¿›åŒ–
        async function checkEvolution() {
            try {
                const response = await fetch('/api/story-growth/growth/check-evolution', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        pet: currentPet
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    if (data.canEvolve) {
                        if (confirm('ğŸ”¥ ä½ çš„å® ç‰©å¯ä»¥è¿›åŒ–äº†ï¼æ˜¯å¦ç«‹å³è¿›åŒ–ï¼Ÿ')) {
                            evolvePet();
                        }
                    } else {
                        showSuccess('æš‚æ—¶è¿˜ä¸èƒ½è¿›åŒ–ï¼Œç»§ç»­åŠªåŠ›å§ï¼');
                    }
                    
                    logResult('è¿›åŒ–æ£€æŸ¥å®Œæˆ', data);
                } else {
                    showError('è¿›åŒ–æ£€æŸ¥å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('è¿›åŒ–æ£€æŸ¥é”™è¯¯: ' + error.message);
                console.error('è¿›åŒ–æ£€æŸ¥é”™è¯¯:', error);
            }
        }

        // æ‰§è¡Œè¿›åŒ–
        async function evolvePet() {
            try {
                showLoading('æ­£åœ¨è¿›åŒ–...');
                
                const response = await fetch('/api/story-growth/growth/evolve', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        pet: currentPet
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    // æ›´æ–°å® ç‰©æ•°æ®
                    currentPet.species = data.result.afterEvolution.name;
                    currentPet.name = data.result.afterEvolution.name;
                    currentPet.stats = data.result.afterEvolution.stats;
                    
                    updatePetDisplay();
                    
                    showSuccess(`ğŸ‰ è¿›åŒ–æˆåŠŸï¼${data.result.beforeEvolution.name} è¿›åŒ–ä¸º ${data.result.afterEvolution.name}ï¼`);
                    alert(data.result.description);
                    
                    logResult('è¿›åŒ–æˆåŠŸ', data);
                } else {
                    showError('è¿›åŒ–å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('è¿›åŒ–é”™è¯¯: ' + error.message);
                console.error('è¿›åŒ–é”™è¯¯:', error);
            }
        }

        // è·å–å® ç‰©çŠ¶æ€
        async function getPetStatus() {
            try {
                const response = await fetch('/api/story-growth/growth/status', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        pet: currentPet
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    displayPetStatus(data.status);
                    logResult('å® ç‰©çŠ¶æ€è·å–æˆåŠŸ', data);
                } else {
                    showError('çŠ¶æ€è·å–å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('çŠ¶æ€è·å–é”™è¯¯: ' + error.message);
                console.error('çŠ¶æ€è·å–é”™è¯¯:', error);
            }
        }

        // æ˜¾ç¤ºå® ç‰©çŠ¶æ€
        function displayPetStatus(status) {
            let statusText = `=== ${status.basic.name} è¯¦ç»†çŠ¶æ€ ===\n\n`;
            statusText += `åŸºæœ¬ä¿¡æ¯:\n`;
            statusText += `- åç§°: ${status.basic.name}\n`;
            statusText += `- ç§æ—: ${status.basic.species}\n`;
            statusText += `- ç­‰çº§: ${status.basic.level}\n`;
            statusText += `- å±æ€§: ${status.basic.type}\n\n`;
            
            statusText += `ç»éªŒå€¼:\n`;
            statusText += `- æ€»ç»éªŒ: ${status.experience.totalExp}\n`;
            statusText += `- å½“å‰ç­‰çº§ç»éªŒ: ${status.experience.expInCurrentLevel}\n`;
            statusText += `- è·ç¦»ä¸‹çº§: ${status.experience.expToNextLevel}\n\n`;
            
            statusText += `è¿›åŒ–ä¿¡æ¯:\n`;
            statusText += `- å½“å‰é˜¶æ®µ: ${status.evolution.currentStage + 1}\n`;
            statusText += `- ä¸‹ä¸€é˜¶æ®µ: ${status.evolution.nextStage || 'å·²è¾¾æœ€é«˜é˜¶æ®µ'}\n`;
            statusText += `- å¯ä»¥è¿›åŒ–: ${status.evolution.canEvolve ? 'æ˜¯' : 'å¦'}\n\n`;
            
            if (status.skills.length > 0) {
                statusText += `å·²å­¦æŠ€èƒ½:\n`;
                status.skills.forEach(skill => {
                    statusText += `- Lv${skill.level}: ${skill.name} (å¨åŠ›${skill.power})\n`;
                });
            }
            
            alert(statusText);
        }

        // è·å–å½“å‰å‰§æƒ…
        async function getCurrentStory() {
            try {
                const response = await fetch(`/api/story-growth/stories/current/${currentPlayerId}`);
                const data = await response.json();
                
                if (data.success) {
                    if (data.hasActiveStory) {
                        showSuccess('æœ‰æ­£åœ¨è¿›è¡Œçš„å‰§æƒ…');
                        logResult('å½“å‰å‰§æƒ…', data.currentStory);
                    } else {
                        showSuccess('å½“å‰æ²¡æœ‰è¿›è¡Œä¸­çš„å‰§æƒ…');
                    }
                } else {
                    showError('è·å–å½“å‰å‰§æƒ…å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('è·å–å½“å‰å‰§æƒ…é”™è¯¯: ' + error.message);
                console.error('è·å–å½“å‰å‰§æƒ…é”™è¯¯:', error);
            }
        }

        // è·å–å¯ç”¨æ•…äº‹
        async function getAvailableStories() {
            try {
                const response = await fetch(`/api/story-growth/stories/available?level=${currentPet.level}&bond=${currentPet.bond}`);
                const data = await response.json();
                
                if (data.success) {
                    let storiesText = 'å¯ç”¨æ•…äº‹:\n\n';
                    data.stories.forEach(story => {
                        storiesText += `${story.title}\n${story.description}\n\n`;
                    });
                    alert(storiesText);
                    logResult('å¯ç”¨æ•…äº‹', data);
                } else {
                    showError('è·å–å¯ç”¨æ•…äº‹å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('è·å–å¯ç”¨æ•…äº‹é”™è¯¯: ' + error.message);
                console.error('è·å–å¯ç”¨æ•…äº‹é”™è¯¯:', error);
            }
        }

        // æµ‹è¯•å‡½æ•°
        async function testHealth() {
            try {
                const response = await fetch('/health');
                const data = await response.json();
                logResult('å¥åº·æ£€æŸ¥', data);
            } catch (error) {
                logResult('å¥åº·æ£€æŸ¥é”™è¯¯', error.message);
            }
        }

        async function testApiInfo() {
            try {
                const response = await fetch('/api/info');
                const data = await response.json();
                logResult('APIä¿¡æ¯', data);
            } catch (error) {
                logResult('APIä¿¡æ¯é”™è¯¯', error.message);
            }
        }

        async function testStoryGrowthAPI() {
            try {
                // æµ‹è¯•è·å–å¯ç”¨æ•…äº‹
                const response = await fetch('/api/story-growth/stories/available');
                const data = await response.json();
                logResult('å‰§æƒ…æˆé•¿APIæµ‹è¯•', data);
            } catch (error) {
                logResult('å‰§æƒ…æˆé•¿APIæµ‹è¯•é”™è¯¯', error.message);
            }
        }

        // å·¥å…·å‡½æ•°
        function showLoading(message) {
            document.getElementById('storyContent').innerHTML = `<div class="loading">${message}</div>`;
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.getElementById('storyContent').appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            document.getElementById('storyContent').appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }

        function logResult(title, data) {
            const resultsDiv = document.getElementById('apiResults');
            const timestamp = new Date().toLocaleTimeString();
            resultsDiv.textContent += `[${timestamp}] ${title}:\n${JSON.stringify(data, null, 2)}\n\n`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function clearResults() {
            document.getElementById('apiResults').textContent = '';
        }
    </script>
</body>
</html>