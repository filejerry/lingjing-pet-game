<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµå¢ƒæ–—å® å½• - AIé©±åŠ¨çš„æ–‡å­—å® ç‰©å…»æˆæ¸¸æˆ</title>
    <meta name="description" content="ä½“éªŒAIé©±åŠ¨çš„æ–‡å­—å® ç‰©å…»æˆæ¸¸æˆï¼Œæ¯ä¸ªé€‰æ‹©éƒ½å°†å½±å“ä½ å® ç‰©çš„è¿›åŒ–æ–¹å‘">
    <meta name="keywords" content="å® ç‰©å…»æˆ,AIæ¸¸æˆ,æ–‡å­—æ¸¸æˆ,å±±æµ·ç»,å® ç‰©å¯¹æˆ˜">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'SimHei', Arial, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            border-bottom: 1px solid #333;
        }

        .game-title {
            font-size: 2.5em;
            color: #ffffff;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .game-subtitle {
            font-size: 1.1em;
            color: #888;
            font-weight: 300;
        }

        .auth-panel {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .auth-title {
            text-align: center;
            font-size: 1.5em;
            color: #ffffff;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: #ccc;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .form-input {
            width: 100%;
            background: #333;
            border: 1px solid #555;
            color: #e0e0e0;
            padding: 12px;
            border-radius: 5px;
            font-size: 1em;
        }

        .form-input:focus {
            outline: none;
            border-color: #ffd700;
        }

        .btn {
            background: #444;
            color: #ffffff;
            border: 2px solid #666;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: #555;
            border-color: #ffd700;
            color: #ffd700;
        }

        .btn-primary {
            background: #ffd700;
            color: #1a1a1a;
            border-color: #ffd700;
        }

        .btn-primary:hover {
            background: #ffed4e;
            border-color: #ffed4e;
        }

        .story-panel {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
            flex-grow: 1;
            display: none;
        }

        .story-content {
            line-height: 1.8;
            font-size: 1.1em;
            margin-bottom: 30px;
        }

        .story-text {
            margin-bottom: 20px;
            color: #e0e0e0;
        }

        .highlight-text {
            color: #ffd700;
            font-weight: bold;
        }

        .pet-status {
            color: #4CAF50;
            font-style: italic;
        }

        .system-text {
            color: #888;
            font-size: 0.95em;
        }

        .choices-container {
            margin-top: 40px;
        }

        .choices-title {
            text-align: center;
            font-size: 1.2em;
            color: #ffffff;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }

        .choices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .choice-card {
            background: #333;
            border: 2px solid #555;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .choice-card:hover {
            border-color: #ffd700;
            background: #3a3a3a;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.2);
        }

        .choice-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 10px;
        }

        .choice-description {
            color: #ccc;
            font-size: 0.95em;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .choice-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .choice-tag {
            background: #555;
            color: #ffd700;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            border: 1px solid #666;
        }

        .pet-info-panel {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .pet-info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }

        .pet-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #ffffff;
        }

        .pet-rarity {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .rarity-N { background: #666; color: white; }
        .rarity-R { background: #4169e1; color: white; }
        .rarity-SR { background: #9932cc; color: white; }
        .rarity-SSR { background: #ff6347; color: white; }
        .rarity-SSS { 
            background: linear-gradient(45deg, #ffd700, #ff6347, #9932cc, #4169e1);
            background-size: 300% 300%;
            animation: rainbow-glow 3s ease-in-out infinite;
            color: white;
        }

        @keyframes rainbow-glow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .pet-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 8px;
            background: #333;
            border-radius: 5px;
            border: 1px solid #555;
        }

        .stat-label {
            font-size: 0.8em;
            color: #888;
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #ffd700;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .chat-mode {
            margin-top: 20px;
            padding: 20px;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            display: none;
        }

        .chat-input {
            width: 100%;
            background: #333;
            border: 1px solid #555;
            color: #e0e0e0;
            padding: 10px;
            border-radius: 5px;
            font-size: 1em;
            margin-bottom: 10px;
        }

        .chat-input:focus {
            outline: none;
            border-color: #ffd700;
        }

        .pricing-panel {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .pricing-title {
            font-size: 1.5em;
            color: #ffd700;
            margin-bottom: 20px;
        }

        .pricing-description {
            color: #ccc;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .pricing-price {
            font-size: 2em;
            color: #ffffff;
            margin-bottom: 20px;
        }

        .features-list {
            text-align: left;
            margin-bottom: 20px;
        }

        .feature-item {
            color: #ccc;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .feature-item:before {
            content: "âœ“";
            color: #4CAF50;
            position: absolute;
            left: 0;
        }

        .auth-switch {
            text-align: center;
            margin-top: 20px;
            color: #888;
        }

        .auth-link {
            color: #ffd700;
            cursor: pointer;
            text-decoration: underline;
        }

        .auth-link:hover {
            color: #ffed4e;
        }

        @media (max-width: 768px) {
            .choices-grid {
                grid-template-columns: 1fr;
            }
            
            .pet-stats {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .action-buttons {
                flex-direction: column;
            }

            .auth-panel {
                margin: 0 10px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1 class="game-title">ğŸ¾ çµå¢ƒæ–—å® å½•</h1>
            <p class="game-subtitle">AIé©±åŠ¨çš„æ–‡å­—å® ç‰©å…»æˆæ¸¸æˆ - æ¯ä¸ªé€‰æ‹©éƒ½å°†å½±å“ä½ å® ç‰©çš„å‘½è¿</p>
        </div>

        <!-- ç™»å½•æ³¨å†Œé¢æ¿ -->
        <div class="auth-panel" id="authPanel">
            <div class="auth-title" id="authTitle">æ¬¢è¿æ¥åˆ°çµå¢ƒæ–—å® å½•</div>
            
            <!-- ç™»å½•è¡¨å• -->
            <div id="loginForm">
                <div class="form-group">
                    <label class="form-label">é‚®ç®±</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="è¯·è¾“å…¥æ‚¨çš„é‚®ç®±">
                </div>
                <div class="form-group">
                    <label class="form-label">å¯†ç </label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="è¯·è¾“å…¥å¯†ç ">
                </div>
                <button class="btn btn-primary" onclick="handleLogin()">ç™»å½•æ¸¸æˆ</button>
                <div class="auth-switch">
                    è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ<span class="auth-link" onclick="switchToRegister()">ç«‹å³æ³¨å†Œ</span>
                </div>
            </div>

            <!-- æ³¨å†Œè¡¨å• -->
            <div id="registerForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">é‚®ç®±</label>
                    <input type="email" class="form-input" id="registerEmail" placeholder="è¯·è¾“å…¥æ‚¨çš„é‚®ç®±">
                </div>
                <div class="form-group">
                    <label class="form-label">å¯†ç </label>
                    <input type="password" class="form-input" id="registerPassword" placeholder="è¯·è®¾ç½®å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰">
                </div>
                <div class="form-group">
                    <label class="form-label">ç¡®è®¤å¯†ç </label>
                    <input type="password" class="form-input" id="confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
                </div>
                <button class="btn btn-primary" onclick="handleRegister()">æ³¨å†Œè´¦å·</button>
                <div class="auth-switch">
                    å·²æœ‰è´¦å·ï¼Ÿ<span class="auth-link" onclick="switchToLogin()">ç«‹å³ç™»å½•</span>
                </div>
            </div>
        </div>

        <!-- ä»˜è´¹è¯´æ˜é¢æ¿ -->
        <div class="pricing-panel" id="pricingPanel" style="display: none;">
            <div class="pricing-title">ğŸ® æ¸¸æˆä½“éªŒå¥—é¤</div>
            <div class="pricing-description">
                è§£é”å®Œæ•´çš„AIå® ç‰©å…»æˆä½“éªŒï¼Œäº«å—æ— é™åˆ¶çš„æ¸¸æˆä¹è¶£
            </div>
            <div class="pricing-price">Â¥29.9 / æœˆ</div>
            <div class="features-list">
                <div class="feature-item">æ— é™åˆ¶åˆ›å»ºå’Œå…»æˆå® ç‰©</div>
                <div class="feature-item">è§£é”æ‰€æœ‰å±±æµ·ç»ç¥å…½</div>
                <div class="feature-item">AIæ™ºèƒ½å¯¹è¯å’Œäº’åŠ¨</div>
                <div class="feature-item">å¤šäººåœ¨çº¿å¯¹æˆ˜åŠŸèƒ½</div>
                <div class="feature-item">ä¸“å±ç¨€æœ‰å® ç‰©çš®è‚¤</div>
                <div class="feature-item">ä¼˜å…ˆå®¢æœæ”¯æŒ</div>
            </div>
            <button class="btn btn-primary" onclick="handlePayment()">ç«‹å³è®¢é˜…</button>
            <button class="btn" onclick="startFreeTrial()">å…è´¹è¯•ç© (3å¤©)</button>
        </div>

        <!-- å® ç‰©ä¿¡æ¯é¢æ¿ -->
        <div class="pet-info-panel" id="petInfoPanel">
            <div class="pet-info-header">
                <div class="pet-name" id="petName">æœªçŸ¥å® ç‰©</div>
                <div class="pet-rarity rarity-N" id="petRarity">æ™®é€š</div>
            </div>
            <div class="pet-stats" id="petStats">
                <!-- å® ç‰©å±æ€§å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <!-- æ¸¸æˆä¸»é¢æ¿ -->
        <div class="story-panel" id="storyPanel">
            <div class="story-content" id="storyContent">
                <div class="story-text">
                    åœ¨é¥è¿œçš„çµå¢ƒå¤§é™†ï¼Œæ¯ä¸ªäººéƒ½èƒ½å¤Ÿä¸çµå…½å»ºç«‹å¥‘çº¦...
                </div>
                <div class="story-text">
                    ä½ ï¼Œä½œä¸ºæ–°æ¥åˆ°çš„çµå¸ˆï¼Œå³å°†å¼€å¯è‡ªå·±çš„å†’é™©ã€‚
                </div>
                <div class="story-text highlight-text">
                    é¦–å…ˆï¼Œä½ éœ€è¦å¬å”¤å±äºè‡ªå·±çš„ç¬¬ä¸€åªä¼™ä¼´ã€‚
                </div>
                <div class="story-text pet-status">
                    æ„Ÿå—åˆ°å†…å¿ƒçš„å‘¼å”¤ï¼Œé€‰æ‹©ä½ çš„ä¼™ä¼´ç±»å‹ï¼š
                </div>
            </div>

            <div class="choices-container">
                <div class="choices-title">é€‰æ‹©ä½ ç†æƒ³çš„ä¼™ä¼´ï¼š</div>
                <div class="choices-grid" id="choicesGrid">
                    <div class="choice-card" onclick="makeChoice('dragon')">
                        <div class="choice-title">ç¥ç§˜çš„é¾™æ—åè£”</div>
                        <div class="choice-description">æ‹¥æœ‰å¤è€è¡€è„‰çš„é¾™æ—å¹¼ä½“ï¼Œå¤©ç”Ÿå…·å¤‡å¼ºå¤§çš„é­”æ³•å¤©èµ‹å’Œå¨ä¸¥æ°”è´¨</div>
                        <div class="choice-tags">
                            <span class="choice-tag">é¾™æ—</span>
                            <span class="choice-tag">é­”æ³•</span>
                            <span class="choice-tag">å¨ä¸¥</span>
                        </div>
                    </div>
                    <div class="choice-card" onclick="makeChoice('phoenix')">
                        <div class="choice-title">æ¶…æ§ƒçš„å‡¤å‡°ä¹‹å­</div>
                        <div class="choice-description">ä¼ è¯´ä¸­å‡¤å‡°çš„åä»£ï¼Œæ‹¥æœ‰æµ´ç«é‡ç”Ÿçš„ç¥åœ£åŠ›é‡å’Œæ²»æ„ˆèƒ½åŠ›</div>
                        <div class="choice-tags">
                            <span class="choice-tag">å‡¤å‡°</span>
                            <span class="choice-tag">æ²»æ„ˆ</span>
                            <span class="choice-tag">ç¥åœ£</span>
                        </div>
                    </div>
                    <div class="choice-card" onclick="makeChoice('kirin')">
                        <div class="choice-title">ä»æ…ˆçš„éº’éºŸå¹¼å´½</div>
                        <div class="choice-description">è±¡å¾ç¥¥ç‘çš„éº’éºŸåä»£ï¼Œæ€§æ ¼æ¸©å’Œå–„è‰¯ï¼Œèƒ½å¸¦æ¥å¥½è¿å’Œå¹³å®‰</div>
                        <div class="choice-tags">
                            <span class="choice-tag">éº’éºŸ</span>
                            <span class="choice-tag">ç¥¥ç‘</span>
                            <span class="choice-tag">æ¸©å’Œ</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="action-buttons" id="actionButtons" style="display: none;">
            <button class="btn" onclick="showPetStatus()">æŸ¥çœ‹å® ç‰©çŠ¶æ€</button>
            <button class="btn" onclick="toggleChatMode()">ä¸å® ç‰©é—²èŠ</button>
            <button class="btn btn-primary" onclick="nextStory()">ç»§ç»­å†’é™©</button>
        </div>

        <!-- èŠå¤©æ¨¡å¼ -->
        <div class="chat-mode" id="chatMode">
            <h3 style="color: #ffd700; margin-bottom: 15px;">ä¸å® ç‰©é—²èŠ</h3>
            <input type="text" class="chat-input" id="chatInput" placeholder="è¾“å…¥ä½ æƒ³å¯¹å® ç‰©è¯´çš„è¯..." onkeypress="handleChatEnter(event)">
            <button class="btn" onclick="sendChat()">å‘é€</button>
            <button class="btn" onclick="toggleChatMode()">ç»“æŸé—²èŠ</button>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentUser = null;
        let currentPet = null;
        let gameState = {
            currentScene: 'auth',
            storyProgress: 0,
            choices: []
        };

        // ç”¨æˆ·è®¤è¯ç›¸å…³
        function switchToRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('authTitle').textContent = 'æ³¨å†Œæ–°è´¦å·';
        }

        function switchToLogin() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('authTitle').textContent = 'ç™»å½•è´¦å·';
        }

        async function handleRegister() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!email || !password) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }

            if (password.length < 6) {
                alert('å¯†ç è‡³å°‘éœ€è¦6ä½');
                return;
            }

            if (password !== confirmPassword) {
                alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                return;
            }

            try {
                // æ¨¡æ‹Ÿæ³¨å†ŒAPIè°ƒç”¨
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                if (response.ok) {
                    alert('æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•');
                    switchToLogin();
                } else {
                    const error = await response.json();
                    alert(error.message || 'æ³¨å†Œå¤±è´¥');
                }
            } catch (error) {
                // ä¸´æ—¶å¤„ç†ï¼šç›´æ¥è¿›å…¥ä»˜è´¹é¡µé¢
                showPricingPanel();
            }
        }

        async function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }

            try {
                // æ¨¡æ‹Ÿç™»å½•APIè°ƒç”¨
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                if (response.ok) {
                    const userData = await response.json();
                    currentUser = userData;
                    showPricingPanel();
                } else {
                    const error = await response.json();
                    alert(error.message || 'ç™»å½•å¤±è´¥');
                }
            } catch (error) {
                // ä¸´æ—¶å¤„ç†ï¼šç›´æ¥è¿›å…¥ä»˜è´¹é¡µé¢
                showPricingPanel();
            }
        }

        function showPricingPanel() {
            document.getElementById('authPanel').style.display = 'none';
            document.getElementById('pricingPanel').style.display = 'block';
        }

        function handlePayment() {
            alert('æ”¯ä»˜åŠŸèƒ½å¼€å‘ä¸­ï¼Œè¯·ç¨åå†è¯•ã€‚\n\nç›®å‰å¯ä»¥å…è´¹è¯•ç©3å¤©ï¼');
            startFreeTrial();
        }

        function startFreeTrial() {
            document.getElementById('pricingPanel').style.display = 'none';
            document.getElementById('storyPanel').style.display = 'block';
            document.getElementById('actionButtons').style.display = 'flex';
            gameState.currentScene = 'pet_creation';
            
            // æ˜¾ç¤ºè¯•ç©æç¤º
            alert('ğŸ‰ æ¬¢è¿å¼€å§‹3å¤©å…è´¹è¯•ç©ï¼\n\nåœ¨è¯•ç©æœŸé—´ï¼Œæ‚¨å¯ä»¥ä½“éªŒæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ã€‚');
        }

        // æ¸¸æˆé€»è¾‘ç›¸å…³
        async function makeChoice(choiceType) {
            const container = document.querySelector('.game-container');
            container.classList.add('loading');

            try {
                if (gameState.currentScene === 'pet_creation') {
                    await createPetFromChoice(choiceType);
                } else {
                    await processGameChoice(choiceType);
                }
            } catch (error) {
                console.error('é€‰æ‹©å¤„ç†å¤±è´¥:', error);
                alert('é€‰æ‹©å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•');
            } finally {
                container.classList.remove('loading');
            }
        }

        async function createPetFromChoice(choiceType) {
            const petDescriptions = {
                'dragon': 'é¾™',
                'phoenix': 'å‡¤å‡°',
                'kirin': 'éº’éºŸ'
            };

            const petName = petDescriptions[choiceType] || 'ç¥ç§˜ç”Ÿç‰©';

            // æ¨¡æ‹Ÿåˆ›å»ºå® ç‰©
            currentPet = {
                id: Date.now(),
                name: `å¹¼å¹´${petName}`,
                species: petName,
                rarity: Math.random() > 0.7 ? 'SSR' : Math.random() > 0.5 ? 'SR' : 'R',
                hp: 80 + Math.floor(Math.random() * 40),
                attack: 20 + Math.floor(Math.random() * 20),
                defense: 15 + Math.floor(Math.random() * 15),
                speed: 18 + Math.floor(Math.random() * 22),
                magic: 25 + Math.floor(Math.random() * 25),
                base_prompt: `ä¸€åªåˆšåˆšå­µåŒ–çš„${petName}å¹¼ä½“ï¼Œçœ¼ä¸­é—ªçƒç€å¥½å¥‡çš„å…‰èŠ’ï¼Œä¼¼ä¹åœ¨ç­‰å¾…ç€ä½ çš„æŒ‡å¼•ã€‚`,
                traits: []
            };

            updatePetDisplay();
            updateStoryAfterPetCreation();
            gameState.currentScene = 'adventure_start';
        }

        function updatePetDisplay() {
            if (!currentPet) return;

            const petInfoPanel = document.getElementById('petInfoPanel');
            const petName = document.getElementById('petName');
            const petRarity = document.getElementById('petRarity');
            const petStats = document.getElementById('petStats');

            petInfoPanel.style.display = 'block';
            petName.textContent = currentPet.name;
            
            const rarity = currentPet.rarity || 'N';
            const rarityNames = { 'N': 'æ™®é€š', 'R': 'ç¨€æœ‰', 'SR': 'è¶…ç¨€æœ‰', 'SSR': 'æç¨€æœ‰', 'SSS': 'ä¼ è¯´' };
            petRarity.textContent = rarityNames[rarity];
            petRarity.className = `pet-rarity rarity-${rarity}`;

            petStats.innerHTML = `
                <div class="stat-item">
                    <div class="stat-label">ç”Ÿå‘½</div>
                    <div class="stat-value">${currentPet.hp}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">æ”»å‡»</div>
                    <div class="stat-value">${currentPet.attack}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">é˜²å¾¡</div>
                    <div class="stat-value">${currentPet.defense}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">æ•æ·</div>
                    <div class="stat-value">${currentPet.speed}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">é­”æ³•</div>
                    <div class="stat-value">${currentPet.magic}</div>
                </div>
            `;
        }

        function updateStoryAfterPetCreation() {
            const storyContent = document.getElementById('storyContent');
            storyContent.innerHTML = `
                <div class="story-text">
                    ä¸€é“å…‰èŠ’é—ªè¿‡ï¼Œä½ çš„ä¼™ä¼´å‡ºç°åœ¨ä½ é¢å‰...
                </div>
                <div class="story-text highlight-text">
                    ${currentPet.name} å¥½å¥‡åœ°çœ‹ç€ä½ ï¼Œä¼¼ä¹åœ¨ç­‰å¾…ä½ çš„æŒ‡å¼•ã€‚
                </div>
                <div class="story-text pet-status">
                    "${currentPet.base_prompt}"
                </div>
                <div class="story-text">
                    ç°åœ¨ï¼Œä½ éœ€è¦å†³å®šæ¥ä¸‹æ¥çš„è¡ŒåŠ¨æ–¹å‘ã€‚
                </div>
            `;

            generateAdventureChoices();
        }

        function generateAdventureChoices() {
            const choicesGrid = document.getElementById('choicesGrid');
            choicesGrid.innerHTML = `
                <div class="choice-card" onclick="makeChoice('explore')">
                    <div class="choice-title">æ¢ç´¢æœªçŸ¥åŒºåŸŸ</div>
                    <div class="choice-description">å¸¦é¢†å® ç‰©æ¢ç´¢ç¥ç§˜çš„å¤è€é—è¿¹ï¼Œå¯èƒ½å‘ç°çè´µçš„å®ç‰©æˆ–é‡åˆ°å±é™©</div>
                    <div class="choice-tags">
                        <span class="choice-tag">å†’é™©</span>
                        <span class="choice-tag">ç»éªŒ</span>
                        <span class="choice-tag">é£é™©</span>
                    </div>
                </div>
                <div class="choice-card" onclick="makeChoice('feed')">
                    <div class="choice-title">å¯»æ‰¾é£Ÿç‰©å–‚å…»</div>
                    <div class="choice-description">ä¸ºå® ç‰©å¯»æ‰¾è¥å…»ä¸°å¯Œçš„é£Ÿç‰©ï¼Œå¢å¼ºå®ƒçš„ä½“è´¨å’Œèƒ½åŠ›</div>
                    <div class="choice-tags">
                        <span class="choice-tag">æˆé•¿</span>
                        <span class="choice-tag">å¥åº·</span>
                        <span class="choice-tag">å®‰å…¨</span>
                    </div>
                </div>
                <div class="choice-card" onclick="makeChoice('train')">
                    <div class="choice-title">è¿›è¡Œæˆ˜æ–—è®­ç»ƒ</div>
                    <div class="choice-description">åœ¨å®‰å…¨çš„ç¯å¢ƒä¸­è®­ç»ƒå® ç‰©çš„æˆ˜æ–—æŠ€å·§ï¼Œæå‡å®æˆ˜èƒ½åŠ›</div>
                    <div class="choice-tags">
                        <span class="choice-tag">è®­ç»ƒ</span>
                        <span class="choice-tag">æŠ€èƒ½</span>
                        <span class="choice-tag">å®åŠ›</span>
                    </div>
                </div>
            `;

            document.querySelector('.choices-title').textContent = 'é€‰æ‹©ä½ çš„ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼š';
        }

        async function processGameChoice(choiceType) {
            // æ¨¡æ‹Ÿæ¸¸æˆé€‰æ‹©å¤„ç†
            const outcomes = {
                'explore': 'ä½ ä»¬åœ¨å¤è€çš„é—è¿¹ä¸­å‘ç°äº†ä¸€å—ç¥ç§˜çš„æ°´æ™¶ï¼Œå® ç‰©çš„é­”æ³•åŠ›å¾—åˆ°äº†æå‡ï¼',
                'feed': 'ä½ æ‰¾åˆ°äº†ä¸€äº›çè´µçš„çµæœï¼Œå® ç‰©åƒåä½“è´¨æ˜æ˜¾å¢å¼ºï¼',
                'train': 'ç»è¿‡åˆ»è‹¦çš„è®­ç»ƒï¼Œå® ç‰©çš„æˆ˜æ–—æŠ€å·§æœ‰äº†æ˜¾è‘—æå‡ï¼'
            };

            const storyContent = document.getElementById('storyContent');
            storyContent.innerHTML = `
                <div class="story-text">
                    ${outcomes[choiceType] || 'ä½ ä»¬ç»§ç»­ç€å†’é™©çš„æ—…ç¨‹...'}
                </div>
                <div class="story-text pet-status">
                    ä½ çš„å® ç‰©ä¼¼ä¹æœ‰äº†ä¸€äº›å˜åŒ–...
                </div>
                <div class="story-text">
                    åœ¨è¿™æ¬¡ç»å†åï¼Œä½ æ„Ÿè§‰åˆ°äº†æ–°çš„å¯èƒ½æ€§ã€‚
                </div>
            `;

            // éšæœºæå‡å±æ€§
            if (currentPet) {
                const statBoosts = {
                    'explore': { magic: 5, hp: 2 },
                    'feed': { hp: 8, defense: 3 },
                    'train': { attack: 6, speed: 4 }
                };

                const boost = statBoosts[choiceType] || {};
                Object.keys(boost).forEach(stat => {
                    currentPet[stat] += boost[stat];
                });

                updatePetDisplay();
            }

            generateNextChoices();
        }

        function generateNextChoices() {
            const choices = [
                {
                    id: 'continue_adventure',
                    title: 'ç»§ç»­å½“å‰çš„å†’é™©',
                    description: 'æ·±å…¥æ¢ç´¢å½“å‰åŒºåŸŸï¼Œå¯»æ‰¾æ›´å¤šçš„æœºé‡å’ŒæŒ‘æˆ˜',
                    tags: ['æŒç»­', 'æ·±å…¥', 'ä¸“æ³¨']
                },
                {
                    id: 'change_direction',
                    title: 'æ”¹å˜å†’é™©æ–¹å‘',
                    description: 'å‰å¾€æ–°çš„åŒºåŸŸï¼Œä½“éªŒä¸åŒçš„å†’é™©å†…å®¹',
                    tags: ['å˜åŒ–', 'æ–°å¥‡', 'å¤šæ ·']
                },
                {
                    id: 'rest_and_plan',
                    title: 'ä¼‘æ¯å¹¶åˆ¶å®šè®¡åˆ’',
                    description: 'æš‚æ—¶ä¼‘æ¯ï¼Œæ•´ç†æ”¶è·ï¼Œä¸ºä¸‹ä¸€æ­¥åšå‡†å¤‡',
                    tags: ['ä¼‘æ¯', 'è§„åˆ’', 'å‡†å¤‡']
                }
            ];

            const choicesGrid = document.getElementById('choicesGrid');
            choicesGrid.innerHTML = choices.map(choice => `
                <div class="choice-card" onclick="makeChoice('${choice.id}')">
                    <div class="choice-title">${choice.title}</div>
                    <div class="choice-description">${choice.description}</div>
                    <div class="choice-tags">
                        ${choice.tags.map(tag => `<span class="choice-tag">${tag}</span>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        function showPetStatus() {
            if (!currentPet) {
                alert('è¯·å…ˆåˆ›å»ºå® ç‰©');
                return;
            }

            alert(`å® ç‰©çŠ¶æ€ï¼š
åç§°: ${currentPet.name}
ç§æ—: ${currentPet.species}
ç¨€æœ‰åº¦: ${currentPet.rarity || 'N'}
ç”Ÿå‘½å€¼: ${currentPet.hp}
æ”»å‡»åŠ›: ${currentPet.attack}
é˜²å¾¡åŠ›: ${currentPet.defense}
æ•æ·åº¦: ${currentPet.speed}
é­”æ³•åŠ›: ${currentPet.magic}
è¯æ¡æ•°é‡: ${currentPet.traits ? currentPet.traits.length : 0}`);
        }

        function toggleChatMode() {
            const chatMode = document.getElementById('chatMode');
            chatMode.style.display = chatMode.style.display === 'none' ? 'block' : 'none';
        }

        function sendChat() {
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();
            
            if (!message || !currentPet) {
                return;
            }

            // æ¨¡æ‹ŸAIå›å¤
            const responses = [
                `${currentPet.name}å‹å¥½åœ°çœ‹ç€ä½ ï¼Œä¼¼ä¹å¾ˆå¼€å¿ƒå¬åˆ°ä½ çš„è¯ã€‚`,
                `${currentPet.name}è½»å£°å›åº”ï¼Œè¡¨è¾¾ç€å¯¹ä½ çš„ä¿¡ä»»ã€‚`,
                `${currentPet.name}æ‘‡æ‘†ç€èº«ä½“ï¼Œæ˜¾å¾—å¾ˆå…´å¥‹ã€‚`,
                `${currentPet.name}é™é™åœ°å¬ç€ï¼Œçœ¼ä¸­é—ªçƒç€æ™ºæ…§çš„å…‰èŠ’ã€‚`
            ];

            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            alert(`ä½ å¯¹${currentPet.name}è¯´ï¼š"${message}"\n\n${randomResponse}`);
            chatInput.value = '';
        }

        function handleChatEnter(event) {
            if (event.key === 'Enter') {
                sendChat();
            }
        }

        function nextStory() {
            if (gameState.currentScene === 'pet_creation') {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå® ç‰©ç±»å‹');
                return;
            }

            generateNextChoices();
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.addEventListener('load', () => {
            console.log('çµå¢ƒæ–—å® å½•å·²åŠ è½½');
        });
    </script>
</body>
</html>