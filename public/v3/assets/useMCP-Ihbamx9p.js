var f=Object.defineProperty;var g=(o,e,t)=>e in o?f(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var h=(o,e,t)=>g(o,typeof e!="symbol"?e+"":e,t);import{r as y}from"./vue-vendor-BrcR7j7v.js";class w{constructor(e){h(this,"config");h(this,"connected",!1);this.config={timeout:3e4,retryCount:3,...e}}async connect(){try{if((await fetch(`${this.config.serverUrl}/health`,{method:"GET",headers:{"Content-Type":"application/json"}})).ok)this.connected=!0,console.log("✅ MCP客户端连接成功");else throw new Error("MCP服务器健康检查失败")}catch(e){throw console.error("❌ MCP连接失败:",e),this.connected=!1,e}}async callTool(e,t){this.connected||(console.warn("⚠️  MCP未连接,尝试重连..."),await this.connect());const r={name:e,arguments:t};try{const n=await this.fetchWithRetry(`${this.config.serverUrl}/tools/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok)throw new Error(`MCP工具调用失败: ${n.statusText}`);return await n.json()}catch(n){throw console.error(`❌ MCP工具 "${e}" 调用失败:`,n),n}}async generateStory(e){try{const t=await this.callTool("generate_story",e);if(t.isError)throw new Error("AI生成剧情失败");const r=t.content.find(n=>n.type==="text");return(r==null?void 0:r.text)||""}catch(t){return console.error("剧情生成失败,使用降级模板:",t),this.getFallbackStory(e.type)}}async calculateEvolution(e){const t=await this.callTool("calculate_evolution",e);if(t.isError)throw new Error("进化计算失败");const r=t.content.find(n=>n.type==="text");return r!=null&&r.text?JSON.parse(r.text):null}async generatePetImage(e){try{const t=await this.callTool("generate_pet_image",e);if(t.isError)return null;const r=t.content.find(n=>n.type==="image"||n.type==="text");return(r==null?void 0:r.data)||(r==null?void 0:r.text)||null}catch(t){return console.error("图片生成失败:",t),null}}async fetchWithRetry(e,t,r=this.config.retryCount){try{const n=new AbortController,i=setTimeout(()=>n.abort(),this.config.timeout),u=await fetch(e,{...t,signal:n.signal});return clearTimeout(i),u}catch(n){if(r>0)return console.log(`⚠️  请求失败,重试中... (剩余${r}次)`),await this.delay(1e3),this.fetchWithRetry(e,t,r-1);throw n}}getFallbackStory(e){return{adventure:"你的宠物在未知的领域开始了一段冒险,前方充满了神秘与未知...",daily:"平静的一天,你与宠物度过了愉快的时光,羁绊悄然增长。",battle:"战斗的号角已经吹响!你的宠物蓄势待发,准备迎接挑战!",evolution:"一股神秘的能量包围着宠物,它的身体开始发生奇妙的变化..."}[e]||"故事继续展开..."}delay(e){return new Promise(t=>setTimeout(t,e))}disconnect(){this.connected=!1,console.log("MCP客户端已断开连接")}isConnected(){return this.connected}}const l=new w({serverUrl:"https://mcp.yourdomain.com"});l.connect().catch(o=>{console.error("MCP自动连接失败:",o)});function v(){const o=y(!1),e=y(null);async function t(a){o.value=!0,e.value=null;try{return await l.generateStory({type:a.type,context:a})}catch(s){throw e.value=s.message||"生成剧情失败",s}finally{o.value=!1}}async function r(a,s){o.value=!0,e.value=null;try{return await l.calculateEvolution({petId:a,behaviors:s})}catch(c){throw e.value=c.message||"获取进化候选失败",c}finally{o.value=!1}}async function n(a,s="shanhaijing"){o.value=!0,e.value=null;try{return await l.generatePetImage({prompt:a,style:s,provider:"vim"})}catch(c){return e.value=c.message||"生成图片失败",null}finally{o.value=!1}}function i(){return l.isConnected()}async function u(){o.value=!0,e.value=null;try{await l.connect()}catch(a){throw e.value=a.message||"MCP连接失败",a}finally{o.value=!1}}return{loading:o,error:e,generateStory:t,getEvolutionCandidates:r,generatePetImage:n,isConnected:i,reconnect:u}}export{v as u};
//# sourceMappingURL=useMCP-Ihbamx9p.js.map
