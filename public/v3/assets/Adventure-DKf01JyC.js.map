{"version":3,"file":"Adventure-DKf01JyC.js","sources":["../../../client/src/views/Adventure.vue"],"sourcesContent":["<template>\r\n  <div class=\"min-h-screen p-6\">\r\n    <!-- 返回按钮 -->\r\n    <router-link to=\"/\" class=\"btn-secondary mb-6 inline-block\">\r\n      ← 返回首页\r\n    </router-link>\r\n\r\n    <div class=\"max-w-4xl mx-auto\">\r\n      <h1 class=\"text-4xl font-bold mb-6\">⚔️ 冒险模式</h1>\r\n\r\n      <!-- 剧情显示区 -->\r\n      <div class=\"card mb-6 min-h-[400px]\">\r\n        <div\r\n          id=\"storyContent\"\r\n          class=\"space-y-4 max-h-[500px] overflow-y-auto p-4\"\r\n        >\r\n          <div\r\n            v-for=\"(line, index) in storyStore.storyLines\"\r\n            :key=\"index\"\r\n            class=\"animate-slide-up\"\r\n            :class=\"line.cssClass\"\r\n          >\r\n            <p class=\"text-lg leading-relaxed\">{{ line.text }}</p>\r\n          </div>\r\n\r\n          <div v-if=\"loading\" class=\"text-center text-gray-400\">\r\n            <div class=\"animate-pulse-slow\">生成中...</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 选择按钮区 -->\r\n      <div v-if=\"storyStore.currentChoices.length > 0\" class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n        <button\r\n          v-for=\"choice in storyStore.currentChoices\"\r\n          :key=\"choice.id\"\r\n          @click=\"makeChoice(choice)\"\r\n          class=\"btn-primary text-left p-4\"\r\n        >\r\n          {{ choice.text }}\r\n        </button>\r\n      </div>\r\n\r\n      <!-- 快捷操作 -->\r\n      <div v-else class=\"flex gap-4\">\r\n        <button\r\n          @click=\"startAdventure\"\r\n          class=\"btn-primary\"\r\n          :disabled=\"loading\"\r\n        >\r\n          {{ loading ? '生成中...' : '开始新冒险' }}\r\n        </button>\r\n        <button\r\n          @click=\"clearStory\"\r\n          class=\"btn-secondary\"\r\n        >\r\n          清空剧情\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, onMounted } from 'vue'\r\nimport { useStoryStore } from '@/stores/story'\r\nimport { usePetStore } from '@/stores/pet'\r\nimport { useMCP } from '@/composables/useMCP'\r\nimport { storyService } from '@/services/storyService'\r\nimport type { StoryChoice } from '@/types/story'\r\n\r\nconst storyStore = useStoryStore()\r\nconst petStore = usePetStore()\r\nconst { generateStory } = useMCP()\r\nconst loading = ref(false)\r\n\r\nonMounted(() => {\r\n  if (!petStore.currentPet) {\r\n    storyStore.addStoryLine('欢迎来到灵境斗宠录!', 'text-xl font-bold')\r\n    storyStore.addStoryLine('请先创建一只宠物开始你的冒险。', 'text-gray-400')\r\n  }\r\n})\r\n\r\nasync function startAdventure() {\r\n  if (!petStore.currentPet) {\r\n    alert('请先创建宠物')\r\n    return\r\n  }\r\n\r\n  loading.value = true\r\n  storyStore.setScene('forest')\r\n\r\n  try {\r\n    // 使用MCP生成剧情\r\n    const story = await generateStory({\r\n      type: 'adventure',\r\n      petId: petStore.currentPet.id,\r\n      scene: 'forest',\r\n      action: 'explore'\r\n    })\r\n\r\n    storyStore.addStoryLine(story)\r\n\r\n    // 模拟选择\r\n    storyStore.setChoices([\r\n      { id: '1', text: '深入森林探索', action: 'explore_deep' },\r\n      { id: '2', text: '返回营地休息', action: 'return_camp' }\r\n    ])\r\n  } catch (error) {\r\n    console.error('冒险开始失败:', error)\r\n    storyStore.addStoryLine('冒险生成失败,请重试。', 'text-red-500')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nasync function makeChoice(choice: StoryChoice) {\r\n  loading.value = true\r\n  storyStore.clearChoices()\r\n\r\n  try {\r\n    const story = await generateStory({\r\n      type: 'adventure',\r\n      petId: petStore.currentPet!.id,\r\n      action: choice.action\r\n    })\r\n\r\n    storyStore.addStoryLine(`你选择了: ${choice.text}`, 'text-yellow-400 font-bold')\r\n    storyStore.addStoryLine(story)\r\n  } catch (error) {\r\n    console.error('选择处理失败:', error)\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nfunction clearStory() {\r\n  storyStore.clearStoryLines()\r\n  storyStore.clearChoices()\r\n}\r\n</script>\r\n"],"names":["storyStore","useStoryStore","petStore","usePetStore","generateStory","useMCP","loading","ref","onMounted","startAdventure","story","error","makeChoice","choice","clearStory","_openBlock","_createElementBlock","_hoisted_1","_createVNode","_component_router_link","_cache","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_Fragment","_unref","line","index","_normalizeClass","_hoisted_5","_toDisplayString","_hoisted_6","_hoisted_7","_renderList","$event","_hoisted_8","_hoisted_9","_hoisted_10"],"mappings":"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"}